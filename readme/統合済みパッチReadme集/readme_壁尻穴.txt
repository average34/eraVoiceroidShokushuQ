東方触手宮 Ver.1.06.9用壁尻スライム落とし穴修正パッチ
…のつもりで作ってたら、1.07.0が出てたっていうオチ。
ファイルの更新日時的にも目視的にも変更は加えられていないのは確認したため、そのまま1.07.0用としてお出しします。


壁尻スライムがどうにもおかしい挙動をするのでERBを開いてみたら、構文がかなり怪しかったので修正をかけさせてもらいました。
結果、壁尻スライムイベントにおいて以下の点が修正されています。

・状況不問で常に被害者を助けることができていたのを修正
　（霊撃処理の前に他者が対象を助けることができるかどうかの判定があるものの、その後の霊撃を使わなかった場合の部分でLOCAL:6が0になるため実質意味がなかった）
　（霊撃未使用時の分岐自体を消すことで対処（LOCAL:6の変更以外に何も処理がなかったので））
・霊撃使用時の処理も見直し
　（なぜかGOTO文の後にPRINT命令と被害者を格納するLOCAL:4を0にする処理があり、またGOTO先はイベントの終了処理部分（イベントの再配置処理前）なのでどちらか片方だけで十分機能する）
　（今回はGOTO文と対応ラベルを削除することで対処。霊撃使用時に何も表示されずにイベントが終了するのも修正されることに）
　（追記：これだけだとLOCAL:6が1の時に状況にそぐわないメッセージが出るので、LOCAL:6も0にするように）
・「ロードしてからの間にこのイベントで「犯す」を選択したことがある場合に「助けない」を選択すると、現在のPT面子や状態、被害者にかかわらず常に前回犯した面子で対象を犯す」という現象の修正
　（LOCAL:7が1になることはあっても0になることはなかったため、一度1になるとLOCAL変数が初期化されるまで常に犯すフラグが立った状態になっていた）
　（冒頭でLOCAL:6～9に0を代入することで対処（LOCAL:6は助けられるかの選択をできるようにするため（霊撃未使用時の0代入を省いたため、別なところで0を代入しないといけない）、
　　LOCAL:8～9はあなたが捕まったときに仲間がおり、かつその全員がふたなり状態だと喪失状態を問わずLOCAL:7が1になるため）。これでもう「自分自身を犯す」という謎の状況にはならない…ハズ）

また、落とし穴系統であなたが落とし穴に閉じ込められた場合にPTメンバーが付いてくるのは不自然だと思うのでこれも対処しました。
…というか元の挙動確認してみたら、そもそもあなたの場合その場から移動してなかったのでテレポート時の動作の一部（場所移動処理）も移植することに…
（RANDOM_TELEPORT関数ではCFLAG:1:4（各キャラクターの現在位置）が変化するだけで、専用に処理を組まないとFLAG:5（プレイヤーの現在地）は変化しないのが原因）
