
■ ご注意
このパッチは 東方触手宮 v1.00.1(eraT0004524) + パッチまとめ0112(eraT0004628) + まとめ用修正ファイル(eraT0004649)用のパッチです
他のバージョンでの動作は保証しません
ERBフォルダにそのまま上書きして使用してください


■ 概要
催眠にかかりながら容赦なく殴りかかるのをやめさせたり
誰も居ないのに仲間を襲えたり、居ないはずの仲間を襲ったりするのを直す
おまけで催眠中のコマンド表示を変更したり
そんなパッチ


■ 変更・追加詳細
SELECT_COMMAND.ERB (変更)
	
	□ 仕様変更
	・コマンド使用可能フラグ(LOCAL)初期化が通常コマンド分しかなかったので 催眠用の初期化も行うためにループ回数を増やした
	　※初期化をしっかりと行う前は、何故か無限に逃げられたり変な動作をしていた (LOCALの初期値が必ず0とは限らない、怖いね)
	・[73]仲間を襲う の使用可能条件を変更 
	　今までは無条件に利用可能だった所を、PTメンバーが2人以上、対象が丸呑みされていないに変更
	・催眠中にREPEATした時、前回行動が戦闘行動だったりすると容赦なく攻撃していた現象を修正
	　前回行動が現在選択できるコマンド以外だった場合、強制的に [71]平常行動 となります
	　[71]平常行動 を選択した理由は、催眠中コマンドで常に選択可能、一番無害そうといった消去法で

	□ コマンド表示関連 (実動作に影響なし)
	・霊撃表示前に改行が発生するが催眠中に霊撃は表示されないので空改行が発生していた
	　霊撃表示時のみ改行するように変更
	・各種催眠コマンド コマンド前に表示される[ XX]が三桁合わせで他のコマンドと表示ズレが発生していたのを修正
	　※味方側行動定義を見る限り、三桁の表示を必要とするコマンドが存在しないため二桁に
	・催眠コマンド時、表示位置がおかしくなっていた [ 6]おねだり の位置を修正
	　[75]逃げる(催眠中) コマンドを、通常コマンド時にあわせて表示位置変更
	・催眠強度によって使用可能コマンド数が変化→ヘンな改行が発生を防止するため + 
	　変化しないコマンドの位置が動かないように、コマンド表示の並び順を通常時コマンド風に変更

FIX_PT_ACTION_73_仲間を襲う.ERB (変更)

	・襲う対象キャラが完全にランダムになっていた点を修正
	　※居ないキャラを襲って キャラID0=あなた が出てたり、届かないはずの丸呑み中の仲間を襲ったり

FIX_ENEMY_ACTION_22.ERB, FIX_ENEMY_ACTION_25.ERB (変更)
	
	・ヒュプノ・レッサーヒュプノの催眠命中時に、攻撃命中キャラの行動コマンドIDを書き換え
	　催眠に掛かった瞬間のターン行動を [45]何もしない に変更します、また溜め攻撃などを防ぐ為にNEXTコマンドも0に
	　あくまでターン行動が修正されるのは催眠に掛かった瞬間のターンのみ　既に催眠状態で、催眠強度UPの時なんかは行動修正しません
	　今までは催眠を食らったターンは、うつろな瞳をしながら殴ったり撃ったりアイテムを使ったりとやりたい放題でした

SYSTEM_MESSAGE_7_敵特殊攻撃発動時.ERB (変更)

	・「レッサーヒュプノの単体催眠」発動時のメッセージが未登録だったためエラーが出ていました
	　「ヒュプノの全体催眠」発動時メッセージからTACHI()を外してコピー


■ 思うところ
催眠中の [75]逃げる コマンド
今までは催眠中であればいくらでも逃げることが出来ましたが
ソースコードの正しい解釈にあわせると、一度逃げると催眠中は二度と逃げられなくなります
(今までは数値が初期化されていなかったバグのせいで幾らでも逃げられた)

個人的にはいくらでも逃げられていいんじゃないかと
諦めずに逃げようとするのもエロいし、何回も近づこうとするのもエロいし
もし幾らでも逃げられるようにするにはSELECT_COMMAND.ERBの

	IF CFLAG:(ARG:0):34 == 0
		;まだ前に行っていないなら前に行ける
		LOCAL:75 = 75
	ENDIF

ってところを

	LOCAL:75 = 75

にするだけです
どっちにする方がいいかはまとめパッチの人に任せたかったり
一応現状ではソースの記述を重視して一度しか逃げられなくなってます