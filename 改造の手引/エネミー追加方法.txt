半ば自分用だゾ！	触手宮敵追加講座	By喚く狂人
ブラウザから見るとなんかインデント狂うところがあるっぽいので、テキストエディタにコピペか何かするのをおすすめします。


1.ERB編集の前に
	1-1.ネタ出し
		何を作るか決めないでERBの編集に入ると、完成しないとは言いませんが迷走します。あらかじめどういう敵なのか決めておきましょう。
		「エロとしての方向性（嗜好）」と「ゲームとしての方向性（敵としての個性）」、両方考えとくと便利です。たとえばアグーなら「豚姦」で「デバフ付与」、ジェリーフィッシュなら「乗っ取り」で「行動阻害」といった感じでした。
		思いつかない？　触手宮を遊んでいて物足りなく感じたことはないですか？　「どうしてこういう敵がいないんだ！」というちんちんのイライラが最大のモチベーションになります。
		思いついたけど触手と関係ない？　UPしてから考えるｲﾝﾀｰﾈｯﾂですよ！

	1-2.先に決めておくべきこと
		敵のランク。ランクに応じて強さも変わってきます。ただしランク7は避けたほうが無難です。7は自然湧きしない敵用のランクです。特殊なのを除いてHPが主に基準のようです。
		敵の種類。コンフィグで湧きを設定するときの分類です。1.女性系、2.植物系、4.動物系、8.丸呑系、16.海産系、32.その他、64.スライム系、128.男性系、256.罠系、512.機械系です。数字はコンフィグでの値を示します。

	1-3.やるべきこと
		まとめパッチとそれ以降に出ているものを全部DLしてきて触手宮に適用しましょう。
		編集するファイルの中に、いくつか「巻き戻し」が発生しうるものがあります。(ENEMY_NAMEとREPOP)

2.SET_ENEMY_DATAをいじる
	2-1.その前に
		まずはENEMYフォルダの中に入っている「ENEMY_敵の番号_敵の名前.ERB」をコピーしましょう。どれでもいいですが、「娘」のような特殊なやつは避けたほうが無難でしょう。
		コピーしたファイルを開きます。このファイルの中には、2つの関数が含まれています（関数とは、一連の処理をまとめて、どっかから呼び出せるようにしたものです。ＲＰＧツクールでいうコモンイベント）。
		@SET_ENEMY_DATA_[敵の番号]は、敵の基本的なデータを設定される関数
		@SET_ENEMY_ACTION_[敵の番号]は、戦闘中の敵の行動を決定したいときに呼ぶ関数
		とりあえず、[敵の番号]のところを変更します。他の敵の番号と被らないものにする必要があります。今後「[敵の番号]というところを置き換えろ」と言ったら、この時使った番号を使ってください。
		おわったら、まずはSET_ENEMY_DATAを弄ります。

	2-2.いじる
		SET_ENEMY_DATAでは、DAという変数を編集します。
		DAは触手宮では敵データの格納場所です。1~99が基本的に使用されており、0はテスト触手ないしペットの種族データが入っています。
		本当はDAと数字の間に(ARG:0)とが入るのですが、いちいち書くのがめんどいので省いています。
		敵データ.txtを見て、作る敵と同ランクの敵データを参照するとバランスに優しくなります。強力な技を使わせるなら低め推奨です。
		あとアルラウネ系とフコウノトリ以上のステにするのも非推奨です。バランスぶっこわれるので。
		フラグ・変数割り当て.txtも参考にするといいでしょう。
			DA:1	現在のHPが入ります。新しく生まれた敵の初期HPにもなります。基本、最大HPと同じでいいでしょう。
			DA:2	最大HPです。
			DA:3	ランクアップ済みフラグ。0だと直後の番号の敵にランクアップするようになります。リビングバインがスカーレットバインになったりするのはこのフラグを利用しています。1だとランクアップしません。
			DA:5	戦闘素質です。
			DA:8	行動回数です。設定した数字だけ行動します。0以下だったり設定しないと1が入ります。
			DA:9	速度です。
			DA:14	ひるみ率補正です。「急所狙い」を受けた時などに参照されます。この数値が怯み率に追加されます。
			DA:15-17	それぞれ、移動時に突撃・慎重・まちぶせを選択する確率です。別に合計100じゃなくてよい　はず
			DA:18	攻撃時の基本命中率（％）。技の命中率にコレをかけたものが実際の命中率になります。ほかにもボーナスとかペナとかかかるけど。
			DA:19	HP自然回復（％）。毎ターン終了時、最大HPにコレをかけた分だけHPが回復しやがります。
			DA:40-44	それぞれ、弾幕・炎弾幕・消耗武器・炎消耗武器・非消耗武器で殴られたときのダメージ倍率。0は1倍扱いなので注意。
			DA:85	触手種別（ビット演算　1.女性系、2.植物系、4.動物系、8.丸呑系、16.海産系、32.その他、64.スライム系、128.男性系、256.罠系、512.機械系）です。複数持っている場合は数値を合計してやってください。例えば動物+丸呑+海産系なら4+8+16で28になります。図鑑と敵の湧きに使用します。
			DA:86	強さランクです。1～7を入れてやってください。低いほどよく出てきます。7は自然には出てこない敵です。フラグで敵の湧きを処理している場合（男傀儡さんなど）、フラグが立っていなければ7を入れてやってください。
			DA:88	1にするとペットにならなくなります
			DA:89	性攻撃で好む部位（ビット演算　1：A  2：B  4：C  8：V  16:無属性or肌属性  32:M）です。複数持っている場合は数値を合計してやってください。例えばAとCを狙うなら1+4で5になります。図鑑と敵の湧きに使用します。
		最後に、%ENEMY_NAME(敵の番号)%という部分を書き換えて終わりです。


3.FIX_ENEMY_ACTIONを弄る
	3-1.基本的なデータを作る
		全部既存の技で済ますならともかく、新しく技を設定する場合はそのデータをつくらないといけません。というわけで作る場合の話です。
		技のデータはBATTLE_敵側の行動定義　に格納されています。
		FIX_ENEMY_ACTIONから適当なやつをコピって、それを編集しましょう。性攻撃を作るなら性攻撃をコピる、など合わせてコピったほうが色々楽です。
		開きました。@FIX_ENEMY_ACTION_[技の番号](ARG:0)という関数がありますね？　技の番号を書き換えます。敵の攻撃コマンド一覧.txtを参考に、作る技に応じたものを割り振りましょう。ただし微妙に古いので、まとめに同梱されてる各種リードミーの敵追加系のものも見ておきましょう（追加敵と技番号がかぶる可能性があります）。
		さて、技のデータ作成ではTFLAGという変数を弄ります。フラグ・変数割り当て.txtも参考にするといいでしょう。
			TFLAG:52	技を使用するキャラです。ARG:0を指定。
			TFLAG:54	対象キャラです。DA:(ARG:0):51を指定。
			TFLAG:55	種別。1～5がそれぞれ、通常・衣服・性・拘束・寄生です。
						コマンド一覧には性（強）という分類がありますが、「拘束時用の性攻撃」に割り当てられる便宜上のものです
			TFLAG:57	ベース威力です。変なことしない限りDA:(ARG:0):5を指定。
			TFLAG:58	コマンド威力です。ベース威力とコレをかけたのが基礎ダメージ値です。
						ダメージを与える先は通常でHP、衣服でCP、性でEP、拘束は無意味、寄生はMPになります。下記は各攻撃のデータを調査してとった目安です。
							通常	→	50~200。100越えはランク6~ぐらいの強敵になります。いわゆる「大振り技」はここを大きくするわけではないので注意。（大振りで変わるのはTFLAG:64）
							衣服	→	大体20~50。100越してるのはイソツビやスライム系です。
							性		→	通常攻撃と同じような感じです。。
							性（強）→	式がややこしいですが、基本的に10000/戦闘素質＋(ここを書き換え)です。書き換え部の目安は大体150~200で、200越えると高ランク敵の技になります。
							拘束	→	無意味
							寄生	→	1OOO/戦闘素質+(ここを書き換え)。20とか30とかそのへん。ダイレクトにMPにダメージ与えるので高くしすぎると大変なことになります。
			TFLAG:59	1なら全体技になります。。
			TFLAG:60	1なら喪失の相手にも効果が出るようになります。大体の技で立ってるフラグです。
			TFLAG:61	命中基準値です。コレにDA:18（％）をかけたものが命中率の基礎値になります。
							通常	→	60~100。100はクイーンの通常のみです。大振り技や二段は60か70に設定されています。
							衣服	→	80~70。
							性		→	150に統一されています。
							性（強）→	性と同じです。
							拘束	→	30~50。
							寄生	→	30~40。
			(TFLAG:62	回避補正です。どうやら実装されてないようなので不要）
			TFLAG:63	メイン性属性です。性・衣服のみ設定します。それ以外がどう動くかは……さあ。0123がそれぞれABCVに対応しており、複合性攻撃でCを責める場合、メインをCにしないとふたなり射精できないようで。
			TFLAG:64	補助値。TFLAG:55の値により働きが色々違う。
							通常	→	CPダメージ倍率。ダメージ基礎値にコレ/1000されます。普通の攻撃で50、大振りが65です。
							衣服	→	MPダメージ倍率。ダメージ基礎値にコレ/1000されます。75か80で、スライムとドッペルが100です
							性		→	MPダメージ倍率。ダメージ基礎値にコレ/1000されます。0固定です。
							性（強）→	MPダメージ倍率。ダメージ基礎値にコレ/1000されます。15固定です。
							拘束	→	同時拘束。1なら二人拘束可。
							寄生	→	寄生か妊娠か。0なら寄生。1以上は射精量。大量射精でないなら8~15程度。大量でも最大で30ぐらい。
			TFLAG:65	補助値2。
							通常	→	使わない。
							衣服	→	CP0時のHPEPへのダメージ倍率。2000~3000ぐらい
							性		→	CPダメージ倍率。0
							性（強）→	CPダメージ倍率。ほぼ50。
							拘束	→	同時拘束。1なら二人拘束可。
							寄生	→	寄生か妊娠か。0なら寄生。1以上は射精量。大量射精な技でないなら8~15程度。大量でも最大で30ぐらい。
			TFLAG:66	メイン処理をスキップするか。1の場合戦闘時のメイン処理を通さない。その場合処理をすべて自分で記述する必要がある。特殊な技用。
			TFLAG:90	絶頂時MPダメージ倍率。性は250固定。性（強）は500~600で、だいたいが600です。
			TFLAG:91	多段攻撃フラグ。回数分攻撃が行われます。0の場合は1になります。
			TFLAG:92	複合属性フラグ。性攻撃の属性を複数にしたい（CV同時攻撃とか）場合設定。1：A  2：B  4：C  8：V 設定したい属性の合計値を入力。メイン属性を入れること。
			TFLAG:93	特殊妊娠(寄生)フラグ。立ってると、寄生技で腹の中に入る子供がリビングバイン~ドリアードからランダムで選ばれるようになります。イベント敵とシェイプ・ドッペルで使用されています。
			TFLAG:95	処女膜を破壊しないV攻撃・寄生攻撃かどうか。1なら処女をなくしません。
			TFLAG:99	特殊効果フラグです。長くなるので後述します。
		満足しました？　下のほうにCALL PRINT_MESSAGE(-1, [技の属性], [技の番号], CALLNAME:(TFLAG:54), SAVESTR:(ARG:0), TFLAG:54)とあるので書き換えましょう。
		[技の属性]のところに入れるのは、TFLAG:55で設定した種別によって変わります。通常なら2、衣服は3、性4、拘束5、寄生6、特殊7です。
		[技の番号]は、最初のほうで決めた番号に書き換えます。
		コピーしたファイル次第ではさらに下にEXTRA_ACTIONという関数があります。ほっとくと関数が元ファイルとでダブってろくな事にならないので、消しましょう。

	3-2.特殊効果を設定したい！
		いくつかの技には特殊効果がありますよね。オクトパス系の吸収、アルラウネ系の花粉なんかがそれです。
		特殊効果をつけるにはTFLAG:99に好みの番号を入れてやる必要があります。番号に応じたEXTRA_ACTIONという関数が呼び出され（この関数は、それ用のファイルがあったりFIX_BATTLE_ACTIONと一緒に記述されていたりします）、その内容が実行されます。
		どの番号がどれに当たるかを下にまとめました。敵コマンド一覧.txtにかかれているものと大体同一ですが、いくつか追加したり、専用効果を除外したりしています。
			18	吸収効果		命中時HPが1割回復します。
			19	絶頂吸収		命中時HPが1割回復します。相手が絶頂時は2割回復です。
			20	自慰誘発		相手の行動を自慰に書き換えます。
			21	フラート		次ターンの性攻撃の威力が3倍になります。
			23	回復の光		処女膜とHPを回復させます。浄化力と使用者のHPが減少します。
			24	強制戦闘終了	まんま。
			29	ひなたぼっこ	自分のHPを最大HPの30%回復
			31	包囲（逃走不能）受けたキャラが逃走に失敗するようになります。
			32	おねだり強制	敵『ジェリーフィッシュ』の導入が必要
			33	仲間を襲わせる	敵『ジェリーフィッシュ』の導入が必要
			34	悪臭の息		ダメージを半減させるバステを付与します。連続して受けると継続ターン増加です。敵『アグー』の導入が必要。
			1300	糸			速度半減のデバフ4ターン付与です。重複しません。
			1301	暗闇		命中低下のデバフ4ターン付与です。重複しません。
			1302	トラウマ	回避低下のデバフ4ターン付与です。重複しません。
			1303	吹雪		回避低下のデバフ4ターン付与です。重複しません。1302との違いは効果発動時のメッセージです。
			1304	まぶしい光	命中低下のデバフ4ターン付与です。重複しません。1301との違いは効果発動時のメッセージです。
			1305	狂気の瞳	命中低下と回避低下2ターン付与です。重複しません。
			1306	ひるみ		相手の行動をキャンセルさせます。
			1307	最大ＥＰダウン	技を受けた相手が絶頂すると、EPを500ダウンさせます。5000まで減ります。回復手段がないので使用非推奨。
			1308	援軍			援軍を呼ぶのですが、誰のことも拘束していない敵が迷宮内に10体以上いないと成功しません。
			1309	戦闘経験ダウン	技を受けた相手が絶頂すると、戦闘経験をダウンさせますが、レベルはダウンしないので無意味です。
			1310	眠気追加		ランダムで眠気が1追加されます。
			1913	触手服を着せる	技を受けた相手が絶頂すると、相手に触手服を着せます。
		作りたい内容がリストに無い？　自分でEXTRA_ACTIONを作ってみるといいと思います。
		今回はチュートリアルなので、そこまでは説明しません。


4.メッセージ作成
	技データをつくっただけだと、当たったり回避されたりしても何も表示されません。メッセージを作成してやる必要があります。
	メッセージはメッセージ・口上関連の各ファイルに書かれています。作った技の種類に対応するファイルを開きます。
	巨大なSELECTCASE分岐がありますね？　その中にCASE (技ID)で新たに分岐を作って、シコシコ書き込んでいきます。
	以下は使われている主な変数やら何やらです。
		ARGS:0		対象キャラの名前です
		ARGS:1		敵の名前です。取り違えると幻想少女が触手をファックしだすので注意。
		ARG:2		対象キャラの番号が入っています。
		LOST_VIRGIN_CHECK(対象キャラの番号)	性攻撃で処女を失ったかの判定です。1だと処女喪失した場合。。
	補足事項として、命中時のメッセージのみ、対象のABLなどを参照するとき、ARG:2を省略できます。TARGETに対象キャラの番号が代入されているためです。
	あと、多段技は仕様上当たるたびに命中メッセージがでるので、命中時メッセージを設定しない方針になっているようです。


5.SET_ENEMY_ACTIONを弄る
	技のデータができたので、どの状況をどの技をどれぐらいの割合で使うかを決めましょう。
	SET_ENEMY_ACTIONには、どういう状況なのか、というコメントが付いていると思います。それにしたがって、LOCAL:2に使わせたい技IDを代入すればOKです。
	SELECTCASE RAND:100 + 1 で百分率チックにしとくと、どの技をどれぐらいの割合で使うのかわかりやすくて便利です。
	以下はバランスのための注意事項です。
		・性攻撃強と寄生技は、拘束していないキャラには使わない（コウノトリは非拘束でも寄生技を使いますが）
		・複数拘束不能なキャラなら、拘束時に非拘束キャラを攻撃する場合は、拘束技を使わない
		・PT外メンバーを拘束している場合、拘束技を使わない
		・拘束した相手（ARG:1）が喪失（CFLAG:29）している場合、「解放」を使うことがあるようにする（LOCAL:2 = 1）
	設定できました？　あと少しです、頑張りましょう！
	ちなみに一部の敵はすでに状態異常の相手に同じ物を使わない、相手が弱っていれば拘束攻撃が多くなる、のような攻撃パターンがあります。詳しくは実際のERBを覗いてみてください。


6.ENEMY_COMMONのSET_ENEMY_TARGET_RATEを弄る
	敵の狙いを設定する部分です。下の方に敵の種類で分岐している部分があるので挙動に独自性が欲しければ追加してみましょう。
	実際の例として戦意喪失したキャラを狙いから外す、HPが減っていて戦意喪失していないキャラを優先して狙うなどがあります。


7.ENEMY_NAMEを弄る
	生み出された敵の名前を設定するのが、ENEMYフォルダ内のENEMY_NAMEです。
	生み出された敵の番号に応じてSELECTCASEで分岐しているので、適切なところに名前を書いてあげましょう。
	中身見ればなんとなくわかります。
	なお、ここをいじったところで、すでに生まれてる敵の名前は変わりません（それはSAVESTRで管理されているため）。あしからず。
	上と下2箇所書き込むところがあるのでそれっぽく書きましょう

8.EVENTFIRST、ENEMY_FILTERを弄る（別人追記）
	FLAG:(700+敵の番号)の初登場フラグがマイナスの時、その敵は基本的に登場しません。
	これを設定するのがいわゆるフィルターです。
	EVENTFIRSTでは各初期設定（○○セット）ごとのエネミーフィルターが、
	ENEMY_FILTERでは各設定ごとにまとめてと個別ごとのエネミーフィルターが設定されています。
	作った敵の番号に合わせてFLAG:701～850のいずれかの設定を変える必要があります。
	と言っても、番号が100未満なら個別ごとのエネミーフィルターはそのままでよく、
	複数をまとめて処理しているうちのFLAG:(LOCAL:1) *= -1の処理から除外されている、
	もしくは後で0に戻されているのから外してやればいいだけです。
	これはまだ敵が登録されていない番号がエネミーフィルターに出て「バグ触手」と表示されるのを防ぐための処理なので、
	その番号に敵が登録されるとその処理が邪魔になるため修正する必要があります。

9.余裕があれば
	SYSTEM_MESSAGE_61_敵初遭遇.ERB、SYSTEM_MESSAGE_157_ゲームオーバー.ERB、SYSTEM_MESSAGE_511_エネミー図鑑.ERB
	にも作成した敵専用のメッセージが入れられます。裏設定なんかを書き込むとプレイヤーがにやにやしてくれるかもしれません。

10.配布に向けて
	ここからは配布時にやっとくとよいことを書きます。
	ここまでで遊べる状態になってる（はず）ので、公開するつもりがないなら問題ないです。
	まずはテストプレイします。最低限リードミーを作ります。以下の内容を入れとくとよいです
		・パッチ名、バージョン、製作者
		・概要
		・敵の説明
		・未使用のフラグを使用した場合はその旨
		・再配布・まとめ導入・改変の可否
		・バグ報告などのための連絡先
		・更新履歴
		・敵のステータス
		・使う技のID
	あとはERBフォルダを作り、その中に弄ったファイルを「触手宮のERBフォルダ以下の構成と同じように」入れます。
	ZIPにします。お疲れ様でした。完成です。うpして反応を楽しみましょう。