東方触手宮　口上フラグ解説


きちんとした文章・資料にまとめたかったんですが、
嫌になるくらいの作業量になりそうだったので、
注意が必要そうな部分だけピックアップすることに。

そして淡々と書いていくのも私が面白くないので、
構文講座風に会話形式で書いてしまえ！
ということでこんなものができてしまいました。


● 登場人物
「　」の人：メイン説明要員
『　』の人：ツッコミ要員　口上作者さん達が疑問に思う内容を予め聞いてくれるかもしれません

誰を割り当てるかは読む人が自分で決めると良いと思うよ！


● はじめに
「というわけで口上関係の解説を任されてしまいました。」

『何で私達がこんなエロゲーの解説しないといけないのよ。』

「作者の趣味ですから仕方ないですね。　さて、時間がもったいないのでキリキリ行きましょう。
　まず、この解説の位置付けですが……元々ある程度口上を書ける人をターゲットとしています。
　触手宮口上を書いてみたけど、こんな条件で分岐させるにはどうしたらいいの？
　何だか状況に合ってない口上が表示されるんだけど……
　などの良くありそうな疑問に応えるべく、分かり辛そうなフラグの補足を行うのがメインです。」

『説明は基本的に口上の "ARG:0" 単位で行っていくわ。
　"PRINT_MESSAGE(口上)フラグ一覧.txt" も一緒に開いておくと良いわね。
　今後の会話で "資料" と言った場合、このフラグ一覧を指していると思ってね。』

「それでは、早速解説に移りましょうか♪」



● ARG:0 が 1 → 味方の攻撃（発動時）
「いきなり大物ですね。口上のテンプレなどを見ていても、ARG:0 だけで判断はせず、
　さらに ARG:1 も参照して分岐をかけることが多いみたいです。」

『この場合の ARG:1 って何が入っているのかしら？』

「資料では "コマンドID" となっていますね。　コマンドID が何なのかは、実は明確な資料が用意されていません。
　一応 "フラグ・変数.txt" の CFLAG:50 の解説にそれっぽいものがありますが、
　パッチなどでどんどん増えたりもするので "ERB\BATTLE\SKILLNAME.ERB" を直接見た方が良いかもしれません。
　まぁ、テンプレや他の口上を参考にしていれば コマンドID の詳細が気になる事はあまり無いと思いますけど。」

『確かに、最初からコメント付きの CASE 文が用意されてたりするから、殆ど気にならないわね。』

「はい、というわけで ARG:1 にはあまり問題ありません。　問題なのは ARG:2 以降なのです。」

『……資料には何も書かれてないけど、ARG:2 にも何か入っているの？』

「実はそうなのです。一部のコマンド限定ですが、ARG:2 にも値が入る事があります。
　コマンドの効果分岐などのために利用されているのですが、この ARG:2 を無視していると
　１回のコマンドで同じメッセージが２回表示されたりするので注意が必要です」

『あぁ、結構よく見るわね、同じメッセージが２回出るのって。　あれって ARG を見てないせいだったんだ。』

「例えば "防御" のコマンドですが、これは通常の防御時のメッセージでは ARG:2 が 0 に、
　消耗武器の弾数リロードが行われる場合、さらに ARG:2 が 1 のデータが飛んできます。」

『リロードが発生すること自体稀だけど、もしそうなると防御してる口上が２回表示されるわけね。』

「はい、ちゃんと ARG:2 == 0 の条件を入れてあれば良いのですが、そうなっていないと
　同じ口上が２回表示されてしまいます。」

『けど、何でそんな面倒な仕様になっているのかしら。
　別の状況を表しているならちゃんと ARG:0 なりを区別すれば良いのに』

「ARG で色々と情報が渡せるから、同じような状況はひとまとめにしちゃえ！
　という作者の軽率な判断が原因らしいですよ。　とりあえずこの形で既に世に出てしまっていますので、
　ここではどういうコマンドが ARG:2 などの影響も受けるのかだけ紹介します。」



～ ARG:2 などの影響も受けるコマンド ～
行頭に ☆ がついているものは、ARG:2 以降に気を付けないと同じメッセージが複数表示されたりする困ったちゃん
   
ARG:1	コマンド名	詳細

☆1		防御		通常は ARG:2 は 0、弾数リロード時は ARG:2 が 1 になります。
　2		アイテム	ARG:2 に使用するアイテムの種類　ARG:3 にアイテムを使う相手が入っています。
　5		逃げる		失敗時は ARG:2 が 0、成功時は ARG:2 が 1 になっています。　成功時はこの後 ARG:0 が 55 の口上も呼ばれます。
☆13	溜め攻撃	溜め開始時は ARG:2 が 0、発射時は ARG:2 が 1 になっています。　ARG:2 の代わりに CFLAG:31 などで見てもOK。
☆42	脱出を試みる　ARG:2 に丸呑みされているかどうか、ARG:4 に誰に捕まっているかどうかが入っています（CFLAG を直接見れば十分…）
					　ARG:3 が複雑で、0→実行時　1→絶頂してて失敗　2→脱出成功　3→拘束レベル低下　4→脱出失敗　となっています
					　ARG:3 が 0 の物が最初に表示され、その後状況に応じて ARG:3 が 1～4 の物が表示されることになります。
☆43	力を溜める	実行時は ARG:2 が 0、絶頂していて力溜めに失敗するとその後 ARG:2 が 1 の物が表示されます。



『……結構あるのね。　特に 42 の "脱出を試みる" なんて、しょっちゅう使うコマンドじゃない。』

「えぇ、なのでこのコマンドの口上を用意する際は特に要注意です。
　本当分かり辛い仕様になってて申し訳ありませんって作者が言ってました。」



● ARG:0 が 34 → EPが0になった
「これは本当に補足だけです。　基本的に ARG:0 が 120 の "絶頂の瞬間" があるので、利用されない口上ですね。」

『資料には ARG:2 で分岐させる予定ってあるけど？』

「作者が力尽きたのでその分岐は無くなりました。
　なので、今の所 "○○はイってしまった！" の前に何か喋らせたい場合しか使い道は無いですね。」

『あっ……ダメ！　イくっ！イっちゃう！！　とかね。……って何言わせるのよ。』

「まぁそんな細かい順番まで気にする人は稀でしょうから、やっぱり ARG:0 が 120 の方だけで事足りますね。」

『スルーされた……』



● ARG:0 が 127 → 寄生・出産イベント
● ARG:0 が 129 → 妊娠・出産イベント
● ARG:0 が 147 → 寄生・出産イベント（寄生された本人以外の口上）
● ARG:0 が 149 → 妊娠・出産イベント（妊娠した本人以外の口上）
「この４つは殆ど同じなので、まとめて説明しちゃいますね」

『ん、ここって何か気を付ける必要があるの？』

「資料にある内容で全てと言えば全てなのですが、ARG:1 に色んな値が入った状態で
　何度も呼び出される点について注意が必要、というところですね。」

『あぁ、ARG:1 を見るようにしておかないと、一度の出産イベントで同じ口上が３回表示されるわけね。』

「そういう事です。 この手の ARG:0 を見ているだけだと同じ口上が何度も出てしまうのは他にもあるので、
　追って紹介していきますね。」



● ARG:0 が 136 → 処女喪失
「というわけでこれも ARG:0 だけを見ていると同じものが表示されてしまうタイプです。」

『えーっと……これは他に何を見ないといけないのかしら？』

「ARG:3 ですね。 ARG:3 が 0 だと処女喪失の瞬間、1 だと処女喪失の直前、2 だと処女喪失を防いだ　となります。」

『……具体的に、どういう状況になるのかしら。』

「処女喪失を防いだ場合、ARG:3 が 2 の口上が呼ばれるだけで終わります。
　実際に処女喪失する場合、最初に ARG:3 が 1 の口上が表示された後、
　ARG:3 が 0 の口上が表示されますね。」

『……なんでわざわざ喪失直前と喪失の瞬間に分けてあるのかしら？』

「EP0の時と同じように、細かなタイミングの違いに対応できるように、だそうですよー。
　作者自身がそのうち口上を作る時に使い分けたかったみたいですが、
　普通の人には邪魔にしかなっていませんね。」



● ARG:0 が 159 → ゲーム開始時
「これは ARG などについては気にする必要無いんですが、運用方法について補足があります。」

『ARG:0 が 203 の "オープニング" と被ってるとか、その辺の事？』

「それもありますが、他にも色々あります。　ではまず "オープニング" との違いについて。
　ARG:0 が 203 の "オープニング" は、ARG:0 が 159 の "ゲーム開始時" よりも先に表示されますが、
　新規ゲーム開始時の "オープニングを表示しますか？" という質問で "いいえ" を選択されると、完全に飛ばされてしまいます。」

『本当の意味で "オープニング" の口上を表示するためにしか使えないってことね。』

「はい、ですからそっちの方は、単なる口上というより、地の文書き換えによるストーリー改変などの用途を想定しています。」

『159 の方はどういう用途なの？』

「こちらは他のバリアントでいうエキストラ構文（素質の有無などの選択）にあたるものですね。
　主人公だけでなく、迷宮に存在する全キャラに対して呼び出されますので、
　素質などの変更はこちらで行うと良いでしょう。」

『既存の触手宮口上なんかで、159 の方にストーリーとか導入みたいなのを書いてるのが沢山あるみたいだけど？』

「そうですね、実はあの形式はあまりオススメできません。
　主人公以外のキャラのオープニングも続々と表示されてしまうので、
　203 の方に書いておく方が良いと思います。
　絶対に飛ばされたくないなどの理由で 159 の方に書く場合は、"自分が主人公かどうかをチェック" した上で
　表示した方が良いでしょう。」

『"自分が主人公かどうかをチェック" ってどうするのよ？』

「既存の口上などでもやっているので詳細は省きますが、要するに口上を表示しているキャラのIDが1＝主人公かどうかを見ればOKです。
　ERB で書くならこんな感じですね。」

IF TARGET == 1
	;私は主人公
ENDIF

『一応聞いておこうかしら。何で TARGET で良いの？』

「口上が表示される際は、"TARGET に喋るキャラのキャラIDが入っている" というルールになっています。
　これがあるから、自分の CFLAG を見たい時は CFLAG:何とか:1 ではなく、CFLAG:1 などと省略できるわけですね。」

『もう１つ確認。キャラID って具体的に何の事？』

「人によって表現・解釈が違う可能性がありますが、資料ではキャラIDは "何番目に作成されたデータか" を指しています。
　主人公なら 1 で、仲間なら 2～10 とかが入っている感じですね。　ARG:1 に "対象キャラ" などと書かれている場合、
　このキャラIDが入っていると思ってください。」

『どこかでキャラ番号だかキャラNOって表記も見かけた気がするけど、そっちは？』

「それは"そのキャラが誰なのか"を表す番号ですね。霊夢さんなら1、魔理沙さんなら2……という感じで、
　プレイヤーさんが誰を主人公にしているかに関係なく、常に同じ数値になります。
　微妙に脱線しますが、FLAG:10 や FLAG:11 に入っている "仲間のID" は、キャラID の方が入っています。
　V1.00 までは "仲間のNo" と書かれていたので、誤解を招きやすくなっていましたね……。」



● ARG:0 が 200 → ランダムイベント発生
「資料で殆ど解説がなされていない部分ですね。
　テンプレや既存の口上を見ればある程度の内容は分かると思いますが、
　ここできちんと解説しておきたいと思います。」

『ARG:1 の "イベントID" はどこかに一覧があるのかしら？』

「"固定イベント一覧.txt" に記載されていますね。　資料では "ランダムイベント" なのに、酷いファイル名です。」

『どちらかと言うと "ランダムイベント" の方が間違ってる気もするけどね。』

「それと、イベントID 100～129 までのアイテム入手系イベントは、ARG:0 が 200 の物ではなく、
　ARG:0 が 113 のアイテム発見口上として扱われます。
　ARG:0 が 200 の分岐の下で、イベントID（ARG:1）が 100～129 のチェックをしても
　意味がありませんから、注意してくださいね。」

『……酷い罠を見た気がするわ。』

「……重ね重ね、分かり辛い仕様になっていて申し訳ありません。
　さて、この口上も ARG:0 が 1 の時と同様、物によって細かく内容が分かれますので、一覧を出したいと思います。」


～ イベント一覧 (パッチ無しの状態) ～
行頭に ☆ がついているものは、ARG:2 以降に気を付けないと同じメッセージが複数表示されたりする困ったちゃん
   
ARG:1	イベント名		詳細

　130	全快湧き水		水を飲んだ場合 ARG:2 が 0、水を飲まなかった場合 ARG:2 が 1 になります。
　131	発情湧き水		水を飲んだ場合 ARG:2 が 0、水を飲まなかった場合 ARG:2 が 1 になります。
　132	ステUP湧き水	水を飲んだ場合 ARG:2 が 0、水を飲まなかった場合 ARG:2 が 1 になります。
　133	澄んだ泉		水を飲んだ場合 ARG:2 が 0、泉に入った場合 ARG:2 が 1、無視した場合 ARG:2 が 2 になります。
　134	白濁泉			ARG:2 によって状況が変わります。長いので以下に列挙
　							0	水を飲んでMP全快
　							1	水を飲んで眠気15に
　							2	水を飲んで全員発情
　							3	泉に入って速度増加
　							4	泉に入って全員寄生
　							5	無視した
　135	不思議な泉		水を飲んだ場合 ARG:2 が 0、泉に入った場合 ARG:2 が 1、無視した場合 ARG:2 が 2 になります。
　136	スライム		避けきれなかった場合 ARG:2 が 1、避けた場合 ARG:2 が 2 になります。
　137	壁触手			避けきれなかった場合 ARG:2 が 1、避けた場合 ARG:2 が 2 になります。
　138	落とし穴		避けきれなかった場合 ARG:2 が 1、避けた場合 ARG:2 が 2 になります。
　139	桃色ガス		避けきれなかった場合 ARG:2 が 1、避けた場合 ARG:2 が 2 になります。
　140	荷物袋			開けた場合 ARG:2 が 0、無視した場合 ARG:2 が 1 になります。
　141	荷物袋トラップ	開けた場合 ARG:2 が 0、無視した場合 ARG:2 が 1 になります。
　142	にょろーん		ARG:2 によって状況が変わります。一部状況では ARG:3 も使います。長いので以下に列挙
　							2	感覚MAXで連れてこられた＋捕まった　ARG:3 に部位（0：A　1：B　2：C　3：V）入り
　							3	感覚MAXで襲われた後＋アイテム貰った　ARG:3 に部位（0：A　1：B　2：C　3：V）入り
　							4	無視した
　							5	コンプリートしてアイテムを貰った
　143	不思議なガス	ARG:2 によって状況が変わります。長いので以下に列挙
　							1	眠くなってきた
　							2	発情し始めた
　							3	自慰が止まらなくなった
　							4	テンションが上がった
　							5	テンションが下がった
　							6	吸わずに済んだ
　144	柔らかい壁		壁を崩せた場合 ARG:2 が 1、壁に呑まれた場合 ARG:2 が 2、無視した場合 ARG:2 が 3 になります。
　145	眠気覚まし		薬草を使った場合 ARG:2 が 1、無視した場合 ARG:2 が 2 になります。
　146	淫蟲A			ARG:2 は利用しません。
　147	淫蟲B			ARG:2 は利用しません。
☆148	淫蟲C			淫蟲に襲われた時点で ARG:2 が 1、その後発情してしまった場合、さらに ARG:2 が 2 の口上が呼び出されます。
☆149	淫蟲V			淫蟲に襲われた時点で ARG:2 が 1、その後寄生されてしまった場合、さらに ARG:2 が 2 の口上が呼び出されます。
　150	落石			避けきれなかった場合 ARG:2 が 1、避けた場合 ARG:2 が 2 になります。
　151	不意打ち		ARG:2 は利用しません。
　
　201	石碑			文字を読めなかった場合 ARG:2 が 0、文字を読めた場合 ARG:2 が 1 になります。
　202	石版赤			ARG:2 によって状況が変わります。長いので以下に列挙
　							0	詳細が良く分からなかった
　							1	既に呪文を唱えている
　							2	光の渦が現れたが、無視した
　							3	何もしなかった
　203	石版青			石版赤と同様
　204	石版黄			石版赤と同様
　205	石版緑			詳細がよく分からなかった場合 ARG:2 が 0、関係ない石版だと分かった場合 ARG:2 が 1 になります。
　206	隠し			口上は存在しません。
　207	統一言語辞書	ARG:2 は利用しません。
　208	電波			口上は存在しません。


『"味方の攻撃" の時と違って本当に全部載せたから、かなり長くなったわね……』

「今までこれらの内容は各イベントのERBファイルを直接見ないと分かりませんでしたからね。
　正式版を名乗る以上は、ERBなんて見なくても口上が書けるように……ということらしいです」

『代わりにこんな長い会話読まされるんじゃ大して変わらない気もするけど。
　ところで、ARG:2 が 0 始まりだったりそうじゃなかったりするのは何でなの？』

「企画時点で他の分岐があったため、0 や 1 を割り当てていたものが、
　最終的に分岐ごと潰れたせいみたいですよ。　例によって分かり辛くなっていますが、
　一覧表とにらめっこしながら書いてもらうしか無いですね……。」

『とりあえず 148 の淫蟲Cと、149 の淫蟲Vだけは気を付けておかないと、
　同じ口上が２回表示されちゃう……というのが重要よね。』

「そうですね、ひとまずそこだけ気を付ければ十分だと思います。」




● おわりに
「というわけで、非常にシステマチックな感じでしたが、以上で解説は終了です。」

『会話形式にしている意味が殆ど無さそうよね。
　むしろ素直に重要そうな表だけ残した方が良かったんじゃない？』

「最初の方にも書かれていますが、それだとモチベーションが保てなかったみたいですよ。
　幸いなことに触手宮はそれなりに人気があるバリアントみたいですから、
　親切な方がそのうちwikiなり別の資料なりで分かりやすく纏めてくれる……かもしれません。」

『本当、協力者の人たち様様よね。』

「『それでは、最後までお付き合いいただきありがとうございました～。』」



