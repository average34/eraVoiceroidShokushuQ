;ARG:0 勃起したキャラID
;ARG:1 勃起レベル増減値
;ARG:2 カラーバーの強制表示  0:通常 1:表示 2:非表示
@ERECTION_B(CHARA_ID, ERECTION_LEVEL, FORCE_PRINT = 0)
#DIM CHARA_ID
#DIM ERECTION_LEVEL
#DIM FORCE_PRINT
#DIM RETRACTED_NIPPLE_ERECTION

;陥没乳首勃起イベントフラグ
RETRACTED_NIPPLE_ERECTION = 0

;増減値がプラス
IF ERECTION_LEVEL >= 0
	IF GET_ERECTION_LEVEL_B(CHARA_ID) == 99 && ERECTION_LEVEL > 0
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, 100)
		CALL PRINT_MESSAGE(CHARA_ID, 466, 0, CALLNAME:CHARA_ID, SAVESTR:(TFLAG:52), TFLAG:52, ERECTION_LEVEL)
	ELSEIF GET_ERECTION_LEVEL_B(CHARA_ID) != 100

		;陥没乳首勃起判定、メッセージ表示はパラメータ変動後に行う為フラグ変動のみ
		IF TALENT:CHARA_ID:159 && !GET_ERECTION_STATE_B(CHARA_ID)
			IF GET_ERECTION_STATE_B(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL))
				RETRACTED_NIPPLE_ERECTION = 1
			ENDIF
		ENDIF
		
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0))
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, MIN(99, GET_ERECTION_LEVEL_B(CHARA_ID)))
	ENDIF
	
	IF FORCE_PRINT != 2
		SIF GET_ERECTION_STATE_B(CHARA_ID) || FORCE_PRINT == 1
			CALL SHOW_ERECTION_COLORBAR_B(CHARA_ID)
	ENDIF
	
	;陥没乳首勃起メッセージ
	IF RETRACTED_NIPPLE_ERECTION
		IF TFLAG:13
			CALL PRINT_MESSAGE(CHARA_ID, 501, TFLAG:52, CALLNAME:CHARA_ID, SAVESTR:(TFLAG:52))
		ELSE
			CALL PRINT_MESSAGE(CHARA_ID, 501, 0, CALLNAME:CHARA_ID, "")
		ENDIF
	ENDIF

;増減値がマイナス
ELSE
	IF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0) == 0 && GET_ERECTION_LEVEL_B(CHARA_ID) > 0
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0))
		CALL PRINT_MESSAGE(CHARA_ID, 470, 0, CALLNAME:CHARA_ID, "")
	ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0) <= 25 && GET_ERECTION_LEVEL_B(CHARA_ID) > 25
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0))
		CALL PRINT_MESSAGE(CHARA_ID, 470, 1, CALLNAME:CHARA_ID, "")
	ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0) <= 50 && GET_ERECTION_LEVEL_B(CHARA_ID) > 50
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0))
		CALL PRINT_MESSAGE(CHARA_ID, 470, 2, CALLNAME:CHARA_ID, "")
	ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0) <= 80 && GET_ERECTION_LEVEL_B(CHARA_ID) > 80
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0))
		CALL PRINT_MESSAGE(CHARA_ID, 470, 3, CALLNAME:CHARA_ID, "")
	ELSE
		CALL SET_ERECTION_LEVEL_B(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_B(CHARA_ID) + ERECTION_LEVEL, 0))
	ENDIF
	
	IF FORCE_PRINT != 2
		CALL SHOW_ERECTION_COLORBAR_B(CHARA_ID)
	ENDIF
ENDIF







;B勃起度を表示
@SHOW_ERECTION_COLORBAR_B(CHARA_ID)
#DIM CHARA_ID
PRINTFORM %CALLNAME:CHARA_ID, 14, LEFT%B勃起度 
SELECTCASE GET_ERECTION_LEVEL_B(CHARA_ID)
CASE 100
	CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_B(CHARA_ID), 100, 20, BARCOLORSET("赤"), RESULT:1)
CASE IS >= 60
	CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_B(CHARA_ID), 100, 20, BARCOLORSET("薄赤"), RESULT:1)
CASE IS >= 40
	CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_B(CHARA_ID), 100, 20, BARCOLORSET("黄"), RESULT:1)
CASE IS >= 20
	CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_B(CHARA_ID), 100, 20, BARCOLORSET("緑"), RESULT:1)
CASEELSE
	CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_B(CHARA_ID), 100, 20, BARCOLORSET("青緑"), RESULT:1)
ENDSELECT
PRINTFORML  {GET_ERECTION_LEVEL_B(CHARA_ID)}％


;B勃起度を取得
;ARG:0 取得するキャラID
@GET_ERECTION_LEVEL_B(CHARA_ID)
#FUNCTION
#DIM CHARA_ID
RETURNF CFLAG:CHARA_ID:164


;B勃起度を設定
;ARG:0 取得するキャラID
@SET_ERECTION_LEVEL_B(CHARA_ID, VALUE)
#DIM CHARA_ID
#DIM VALUE
CFLAG:CHARA_ID:164 = LIMIT(VALUE, 0, 100)


;B勃起状態を取得
;0:勃起していない 1:勃起している 2:最大勃起
;ARG:0 取得するキャラID
;ARG:1 チェック値、省略時0(チェック値を与えた際は、そちらの値で勃起するかどうかを調べる)
@GET_ERECTION_STATE_B(CHARA_ID, CORRECTION_ERECTION_LEVEL = 0)
#FUNCTION
#DIM CHARA_ID
#DIM CORRECTION_ERECTION_LEVEL
IF CORRECTION_ERECTION_LEVEL
	IF CORRECTION_ERECTION_LEVEL >= 100
		RETURNF 2
	ELSEIF CORRECTION_ERECTION_LEVEL > 60
		RETURNF 1
	ENDIF
ELSE
	IF CFLAG:CHARA_ID:164 >= 100
		RETURNF 2
	ELSEIF CFLAG:CHARA_ID:164 > 60
		RETURNF 1
	ENDIF
ENDIF
RETURNF 0



;ARG:0 勃起したキャラID
;ARG:1 勃起レベル増減値
;ARG:2 カラーバーの強制表示  0:通常 1:表示 2:非表示
@ERECTION_C(CHARA_ID, ERECTION_LEVEL, FORCE_PRINT = 0)
#DIM CHARA_ID
#DIM ERECTION_LEVEL
#DIM FORCE_PRINT

;ペニスあり(ふたなりまたは男)
IF GET_PENIS(CHARA_ID)
	;増減値がプラス
	IF ERECTION_LEVEL >= 0
		IF GET_ERECTION_LEVEL_C(CHARA_ID) == 199 && ERECTION_LEVEL > 0
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, 200)
			CALL PRINT_MESSAGE(CHARA_ID, 466, 2, CALLNAME:CHARA_ID, SAVESTR:(TFLAG:52), TFLAG:52, ERECTION_LEVEL)
		ELSEIF GET_ERECTION_STATE_C(CHARA_ID, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL) >= 2 && GET_ERECTION_STATE_C(CHARA_ID) <= 1 && ERECTION_LEVEL > 0
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MIN(199, GET_ERECTION_LEVEL_C(CHARA_ID)))
			CALL PRINT_MESSAGE(CHARA_ID, 466, 3, CALLNAME:CHARA_ID, SAVESTR:(TFLAG:52), TFLAG:52, ERECTION_LEVEL)
		ELSEIF GET_ERECTION_LEVEL_C(CHARA_ID) != 200
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MIN(199, GET_ERECTION_LEVEL_C(CHARA_ID)))
		ENDIF
		
		IF FORCE_PRINT != 2
			SIF GET_ERECTION_STATE_C(CHARA_ID) || FORCE_PRINT == 1
				CALL SHOW_ERECTION_COLORBAR_C(CHARA_ID)
		ENDIF
		
	;増減値がマイナス
	ELSE
		IF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) == 0 && GET_ERECTION_LEVEL_C(CHARA_ID) > 0
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 0, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 25 && GET_ERECTION_LEVEL_C(CHARA_ID) > 25
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 1, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 50 && GET_ERECTION_LEVEL_C(CHARA_ID) > 50
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 2, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 80 && GET_ERECTION_LEVEL_C(CHARA_ID) > 80
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 3, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 120 && GET_ERECTION_LEVEL_C(CHARA_ID) > 120
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 4, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 160 && GET_ERECTION_LEVEL_C(CHARA_ID) > 160
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 5, CALLNAME:CHARA_ID, "")
		ELSE
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
		ENDIF
		
		IF FORCE_PRINT != 2
			CALL SHOW_ERECTION_COLORBAR_C(CHARA_ID)
		ENDIF
	ENDIF
	
	
	
;女
ELSE
	;増減値がプラス
	IF ERECTION_LEVEL >= 0
		IF GET_ERECTION_LEVEL_C(CHARA_ID) == 99 && ERECTION_LEVEL
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, 100)
			CALL PRINT_MESSAGE(CHARA_ID, 466, 1, CALLNAME:CHARA_ID, SAVESTR:(TFLAG:52), TFLAG:52, ERECTION_LEVEL)
		ELSEIF GET_ERECTION_LEVEL_C(CHARA_ID) != 100
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MIN(99, GET_ERECTION_LEVEL_C(CHARA_ID)))
		ENDIF
		
		IF FORCE_PRINT != 2
			SIF GET_ERECTION_STATE_C(CHARA_ID) || FORCE_PRINT == 1
				CALL SHOW_ERECTION_COLORBAR_C(CHARA_ID)
		ENDIF
		
	;増減値がマイナス
	ELSE
		IF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) == 0 && GET_ERECTION_LEVEL_C(CHARA_ID) > 0
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 0, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 25 && GET_ERECTION_LEVEL_C(CHARA_ID) > 25
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 1, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 50 && GET_ERECTION_LEVEL_C(CHARA_ID) > 50
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 2, CALLNAME:CHARA_ID, "")
		ELSEIF MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0) <= 80 && GET_ERECTION_LEVEL_C(CHARA_ID) > 80
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
			CALL PRINT_MESSAGE(CHARA_ID, 471, 3, CALLNAME:CHARA_ID, "")
		ELSE
			CALL SET_ERECTION_LEVEL_C(CHARA_ID, MAX(CFLAG:CHARA_ID:28 * 10, GET_ERECTION_LEVEL_C(CHARA_ID) + ERECTION_LEVEL, 0))
		ENDIF
		
		IF FORCE_PRINT != 2
			CALL SHOW_ERECTION_COLORBAR_C(CHARA_ID)
		ENDIF
	ENDIF
ENDIF


		

;C勃起度を表示
@SHOW_ERECTION_COLORBAR_C(CHARA_ID)
#DIM CHARA_ID
;ペニスあり(ふたなりまたは男)
IF GET_PENIS(CHARA_ID)
	PRINTFORM %CALLNAME:CHARA_ID, 14, LEFT%C勃起度 
	SELECTCASE GET_ERECTION_LEVEL_C(CHARA_ID)
	CASE IS >= 100
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 200, 20, BARCOLORSET("赤"), RESULT:1)
	CASE IS >= 60
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("薄赤"), RESULT:1)
	CASE IS >= 40
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("黄"), RESULT:1)
	CASE IS >= 20
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("緑"), RESULT:1)
	CASEELSE
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("青緑"), RESULT:1)
	ENDSELECT
	PRINTFORML  {GET_ERECTION_LEVEL_C(CHARA_ID)}％
;女
ELSE
	PRINTFORM %CALLNAME:CHARA_ID, 14, LEFT%C勃起度 
	SELECTCASE GET_ERECTION_LEVEL_C(CHARA_ID)
	CASE IS >= 60
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("薄赤"), RESULT:1)
	CASE IS >= 40
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("黄"), RESULT:1)
	CASE IS >= 20
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("緑"), RESULT:1)
	CASEELSE
		CALL PRINT_COLORBAR(GET_ERECTION_LEVEL_C(CHARA_ID), 100, 20, BARCOLORSET("青緑"), RESULT:1)
	ENDSELECT
	PRINTFORML  {GET_ERECTION_LEVEL_C(CHARA_ID)}％
ENDIF



;C勃起度を取得
;ARG:0 取得するキャラID
@GET_ERECTION_LEVEL_C(CHARA_ID)
#FUNCTION
#DIM CHARA_ID
RETURNF CFLAG:CHARA_ID:165


;C勃起度を設定
;ARG:0 取得するキャラID
@SET_ERECTION_LEVEL_C(CHARA_ID, VALUE)
#DIM CHARA_ID
#DIM VALUE
IF GET_PENIS(CHARA_ID)
	CFLAG:CHARA_ID:165 = LIMIT(VALUE, 0, 200)
ELSE
	CFLAG:CHARA_ID:165 = LIMIT(VALUE, 0, 100)
ENDIF


;C勃起状態を取得
;0:勃起していない 1:勃起している 2:限界を超えて勃起している(ペニスあり時のみ) 3:最大勃起
;ARG:0 取得するキャラID
;ARG:1 チェック値、省略時0(チェック値を与えた際は、そちらの値で勃起するかどうかを調べる)
@GET_ERECTION_STATE_C(CHARA_ID, CORRECTION_ERECTION_LEVEL = 0)
#FUNCTION
#DIM CHARA_ID
#DIM CORRECTION_ERECTION_LEVEL
IF CORRECTION_ERECTION_LEVEL
	IF GET_PENIS(CHARA_ID)
		IF CORRECTION_ERECTION_LEVEL >= 200
			RETURNF 3
		ELSEIF CORRECTION_ERECTION_LEVEL > 100
			RETURNF 2
		ELSEIF CORRECTION_ERECTION_LEVEL > 60
			RETURNF 1
		ENDIF
	ELSE
		IF CORRECTION_ERECTION_LEVEL >= 100
			RETURNF 3
		ELSEIF CORRECTION_ERECTION_LEVEL > 60
			RETURNF 1
		ENDIF
	ENDIF
ELSE
	IF GET_PENIS(CHARA_ID)
		IF CFLAG:CHARA_ID:165 >= 200
			RETURNF 3
		ELSEIF CFLAG:CHARA_ID:165 > 100
			RETURNF 2
		ELSEIF CFLAG:CHARA_ID:165 > 60
			RETURNF 1
		ENDIF
	ELSE
		IF CFLAG:CHARA_ID:165 >= 100
			RETURNF 3
		ELSEIF CFLAG:CHARA_ID:165 > 60
			RETURNF 1
		ENDIF
	ENDIF
ENDIF
RETURNF 0

