;感度などによるEP倍率を計算
;ARG:0	対象キャラ
;ARG:1	属性（0～3でA～V） 5で属性なし 9でM
;ARG:2	ベースとなる値
@CALC_SENSITIVITY(ARG:0, ARG:1, ARG:2)
#FUNCTION

;LOCAL
;1	計算結果
;2	倍率
;3	TEMP

LOCAL:2 = 100
;経験補正
IF ARG:1 < 4
	LOCAL:3 = 6 + ARG:1
ELSEIF ARG:1 == 5
	LOCAL:3 = 11
ELSEIF ARG:1 == 9
	LOCAL:3 = 15
ENDIF
IF ABL:(ARG:0):(LOCAL:3) == 0
	LOCAL:2 = LOCAL:2 * 1
ELSEIF ABL:(ARG:0):(LOCAL:3) == 1
	LOCAL:2 = LOCAL:2 * 12 / 10
;肌感覚はダメージが増えにくい
ELSEIF ABL:(ARG:0):(LOCAL:3) == 2 || ARG:1 == 5
	LOCAL:2 = LOCAL:2 * 15 / 10
;EPリミットあり
ELSEIF ABL:(ARG:0):(LOCAL:3) == 3 && FLAG:539
	LOCAL:2 = LOCAL:2 * 22 / 10
ELSE
	;19桁まで
	IF EXP:(ARG:0):(LOCAL:3) > 5000000000000000000
		EXP:(ARG:0):(LOCAL:3) = 5000000000000000000
	ENDIF
	SIF EXP:(ARG:0):(LOCAL:3) > 0
		LOCAL:2 = LOCAL:2 * SQRT(EXP:(ARG:0):(LOCAL:3))/100
ENDIF

;感度補正
IF ARG:1 < 4
	LOCAL:3 = 101 + ARG:1
ELSEIF ARG:1 == 5
	LOCAL:3 = 105
ELSEIF ARG:1 == 9
	LOCAL:3 = 106
ENDIF
IF TALENT:(ARG:0):(LOCAL:3) == -1
	LOCAL:2 = LOCAL:2 * 6 / 10
ELSEIF TALENT:(ARG:0):(LOCAL:3) == 1
	LOCAL:2 = LOCAL:2 * 13 / 10
ELSEIF TALENT:(ARG:0):(LOCAL:3) == 2
	LOCAL:2 = LOCAL:2 * 16 / 10
ELSEIF TALENT:(ARG:0):(LOCAL:3) == 3
	LOCAL:2 = LOCAL:2 * 20 / 10
ELSE
	LOCAL:2 = LOCAL:2 * 1
ENDIF


;淫乱系素質補正
IF ARG:1 < 4
	LOCAL:3 = 75 + ARG:1
ELSEIF ARG:1 == 5
	LOCAL:3 = 74
ELSEIF ARG:1 == 9
	LOCAL:3 = 79
ENDIF
IF TALENT:(ARG:0):(LOCAL:3)
	LOCAL:2 = LOCAL:2 * 15 / 10
ELSE
	LOCAL:2 = LOCAL:2 * 1
ENDIF


IF ARG:1 == 1
	;B属性メインの場合、乳サイズの影響を受ける
	SELECTCASE GET_BUST(ARG:0)
		CASE IS <= -2
			LOCAL:2 = LOCAL:2 * 12 / 10
		CASE -1
			LOCAL:2 = LOCAL:2 * 11 / 10
		CASE 0
		CASE 1
			LOCAL:2 = LOCAL:2 * 8 / 10
		CASE 2
			LOCAL:2 = LOCAL:2 * 7 / 10
		CASE IS >= 3
			LOCAL:2 = LOCAL:2 * 6 / 10
	ENDSELECT
	
	;母乳体質なら噴乳中毒で快感ダメージ増加
	IF TALENT:(ARG:0):130 && ABL:(ARG:0):16
		IF ABL:(ARG:0):16 == 3
			LOCAL:2 = LOCAL:2 * 15 / 10
		ELSEIF ABL:(ARG:0):16 == 2
			LOCAL:2 = LOCAL:2 * 13 / 10
		ELSEIF ABL:(ARG:0):16 == 1
			LOCAL:2 = LOCAL:2 * 11 / 10
		ENDIF
		;母乳粘度によりダメージ増加
		SELECTCASE TALENT:(ARG:0):220
			CASE 1
			CASE 2
				LOCAL:2 = LOCAL:2 * 11 / 10
			CASE 3
				LOCAL:2 = LOCAL:2 * 12 / 10
			CASE 4
				LOCAL:2 = LOCAL:2 * 13 / 10
			CASE 5
				LOCAL:2 = LOCAL:2 * 14 / 10
			CASE IS >= 6
				LOCAL:2 = LOCAL:2 * 15 / 10
			CASEELSE
		ENDSELECT
	ENDIF
	
	IF GET_ERECTION_LEVEL_B(ARG:0) == 100
		LOCAL:2 = LOCAL:2 * 13 / 10
	ENDIF

ENDIF

IF ARG:1 == 2
	IF GET_ERECTION_LEVEL_C(ARG:0) > 99
		LOCAL:2 = LOCAL:2 * GET_ERECTION_LEVEL_C(ARG:0) * 11 / 1000
	ENDIF
ENDIF

IF ARG:1 == 5
	;肌属性メインの場合、動物耳で補正
	SIF TALENT:(ARG:0):124
		LOCAL:2 = LOCAL:2 * 12 / 10
ENDIF

IF ARG:1 == 9
	;M属性メインの場合、ネコ舌で補正
	SIF TALENT:(ARG:0):54
		LOCAL:2 = LOCAL:2 * 12 / 10
ENDIF


;以下、複合属性処理
;メイン属性と重なっていても、重複してダメージ変動
IF TFLAG:92 & 1
	;複合属性A
	LOCAL:3 = 6
	IF ABL:(ARG:0):(LOCAL:3) == 0
		LOCAL:2 += 0
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 10
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 25
	ELSE
		LOCAL:2 += 50
	ENDIF

	LOCAL:3 = 101
	IF TALENT:(ARG:0):(LOCAL:3) == -1
		LOCAL:2 -= 10
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 15
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 30
	ELSEIF TALENT:(ARG:0):(LOCAL:3) >= 3
		LOCAL:2 += 45
	ELSE
		LOCAL:2 += 0
	ENDIF
	
	;淫乱系素質補正
	LOCAL:3 = 75
	IF TALENT:(ARG:0):(LOCAL:3)
		LOCAL:2 += 40
	ELSE
		LOCAL:2 += 0
	ENDIF
ENDIF
IF TFLAG:92 & 2
	;複合属性B
	LOCAL:3 = 7
	IF ABL:(ARG:0):(LOCAL:3) == 0
		LOCAL:2 += 0
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 10
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 25
	ELSE
		LOCAL:2 += 50
	ENDIF
	;母乳体質なら噴乳中毒で快感ダメージ増加
	IF TALENT:(ARG:0):130 && ABL:(ARG:0):16
		IF ABL:(ARG:0):16 == 3
			LOCAL:2 = LOCAL:2 * 15 / 10
		ELSEIF ABL:(ARG:0):16 == 2
			LOCAL:2 = LOCAL:2 * 13 / 10
		ELSEIF ABL:(ARG:0):16 == 1
			LOCAL:2 = LOCAL:2 * 11 / 10
		ENDIF
		;母乳粘度によりダメージ増加
		SELECTCASE TALENT:(ARG:0):220
			CASE 1
			CASE 2
				LOCAL:2 = LOCAL:2 * 11 / 10
			CASE 3
				LOCAL:2 = LOCAL:2 * 12 / 10
			CASE 4
				LOCAL:2 = LOCAL:2 * 13 / 10
			CASE 5
				LOCAL:2 = LOCAL:2 * 14 / 10
			CASE IS >= 6
				LOCAL:2 = LOCAL:2 * 15 / 10
			CASEELSE
		ENDSELECT
	ENDIF
	LOCAL:3 = 102
	IF TALENT:(ARG:0):(LOCAL:3) == -1
		LOCAL:2 -= 10
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 15
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 30
	ELSEIF TALENT:(ARG:0):(LOCAL:3) >= 3
		LOCAL:2 += 45
	ELSE
		LOCAL:2 += 0
	ENDIF
	
	
	;淫乱系素質補正
	LOCAL:3 = 76
	IF TALENT:(ARG:0):(LOCAL:3)
		LOCAL:2 += 40
	ELSE
		LOCAL:2 += 0
	ENDIF
	IF GET_ERECTION_LEVEL_B(ARG:0) == 100
		LOCAL:2 += 20
	ENDIF

ENDIF
IF TFLAG:92 & 4
	;複合属性C
	LOCAL:3 = 8
	IF ABL:(ARG:0):(LOCAL:3) == 0
		LOCAL:2 += 0
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 10
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 25
	ELSE
		LOCAL:2 += 50
	ENDIF

	LOCAL:3 = 103
	IF TALENT:(ARG:0):(LOCAL:3) == -1
		LOCAL:2 -= 10
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 15
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 30
	ELSEIF TALENT:(ARG:0):(LOCAL:3) >= 3
		LOCAL:2 += 45
	ELSE
		LOCAL:2 += 0
	ENDIF
	
	
	;淫乱系素質補正
	LOCAL:3 = 77
	IF TALENT:(ARG:0):(LOCAL:3)
		LOCAL:2 += 40
	ELSE
		LOCAL:2 += 0
	ENDIF
	
	IF GET_ERECTION_LEVEL_C(ARG:0) > 99
		LOCAL:2 += GET_ERECTION_LEVEL_C(ARG:0) + 90
	ENDIF
ENDIF
IF TFLAG:92 & 8
	;複合属性V
	LOCAL:3 = 9
	IF ABL:(ARG:0):(LOCAL:3) == 0
		LOCAL:2 += 0
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 10
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 25
	ELSE
		LOCAL:2 += 50
	ENDIF

	LOCAL:3 = 104
	IF TALENT:(ARG:0):(LOCAL:3) == -1
		LOCAL:2 -= 10
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 15
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 30
	;こっそり追加
	ELSEIF TALENT:(ARG:0):(LOCAL:3) >= 3
		LOCAL:2 += 45
	ELSE
		LOCAL:2 += 0
	ENDIF
	
	
	;淫乱系素質補正
	LOCAL:3 = 78
	IF TALENT:(ARG:0):(LOCAL:3)
		LOCAL:2 += 40
	ELSE
		LOCAL:2 += 0
	ENDIF
ENDIF
IF TFLAG:92 & 16
	;複合属性肌
	LOCAL:3 = 11
	IF ABL:(ARG:0):(LOCAL:3) == 0
		LOCAL:2 += 0
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 10
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 25
	ELSE
		LOCAL:2 += 50
	ENDIF

	LOCAL:3 = 105
	IF TALENT:(ARG:0):(LOCAL:3) == -1
		LOCAL:2 -= 10
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 15
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 30
	ELSEIF TALENT:(ARG:0):(LOCAL:3) >= 3
		LOCAL:2 += 45
	ELSE
		LOCAL:2 += 0
	ENDIF
	
	
	;淫乱系素質補正
	LOCAL:3 = 74
	IF TALENT:(ARG:0):(LOCAL:3)
		LOCAL:2 += 40
	ELSE
		LOCAL:2 += 0
	ENDIF
ENDIF
IF TFLAG:92 & 32
	;複合属性M
	LOCAL:3 = 15
	IF ABL:(ARG:0):(LOCAL:3) == 0
		LOCAL:2 += 0
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 10
	ELSEIF ABL:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 25
	ELSE
		LOCAL:2 += 50
	ENDIF

	LOCAL:3 = 106
	IF TALENT:(ARG:0):(LOCAL:3) == -1
		LOCAL:2 -= 10
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 1
		LOCAL:2 += 15
	ELSEIF TALENT:(ARG:0):(LOCAL:3) == 2
		LOCAL:2 += 30
	ELSEIF TALENT:(ARG:0):(LOCAL:3) >= 3
		LOCAL:2 += 45
	ELSE
		LOCAL:2 += 0
	ENDIF
	
	
	;淫乱系素質補正
	LOCAL:3 = 79
	IF TALENT:(ARG:0):(LOCAL:3)
		LOCAL:2 += 40
	ELSE
		LOCAL:2 += 0
	ENDIF
ENDIF

LOCAL:1 = ARG:2 * LOCAL:2 / 100

;バグ対策
IF LOCAL:1 <= 0
	LOCAL:1 = 1
ENDIF

RETURNF LOCAL:1

;CP残量によるEPダメージ倍率取得
;ARG:0	対象キャラ
@GET_CP_RATE(ARG:0)
#FUNCTION

;防御側CP倍率
LOCAL:1 = 0
LOCAL:2 = BASE:(ARG:0):3 * 100 / MAXBASE:(ARG:0):3
IF LOCAL:2 <= 0
	LOCAL:1 = 200
ELSEIF LOCAL:2 <= 33
	LOCAL:1 = 150
ELSEIF LOCAL:2 <= 66
	LOCAL:1 = 120
ELSE
	LOCAL:1 = 100
ENDIF
;はいてない
IF CFLAG:(ARG:0):44 == 1 && (TFLAG:63 == 0 || TFLAG:63 == 2 || TFLAG:63 == 3)
	LOCAL:1 = 200
;おもらし（小）
ELSEIF CFLAG:(ARG:0):44 == 2 && TFLAG:63 == 2
	LOCAL:1 = 150
;おもらし（大）
ELSEIF CFLAG:(ARG:0):44 == 3 && TFLAG:63 == 0
	LOCAL:1 = 150
;おもらし（小・大）
ELSEIF CFLAG:(ARG:0):44 == 4 && (TFLAG:63 == 0 || TFLAG:63 == 2)
	LOCAL:1 = 250
ENDIF
RETURNF LOCAL:1

