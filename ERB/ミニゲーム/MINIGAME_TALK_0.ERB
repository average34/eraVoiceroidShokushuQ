;通常の会話イベント
;ARG:0	対象キャラ
@MINIGAME_TALK_0(ARG:0)
;LOCAL
;0	LOOP

;5-6	HP低下
;7-8	MP低下
;9		CP低下
;10		寄生

PRINTFORML 
PRINTFORML 
TRYCALL PRINT_SHOW_CLOTH(ARG:0)

PRINTFORM %CALLNAME:(ARG:0)%と出会った
PRINTFORML 

WAIT

$TALK_START
IF BASE:(ARG:0):0 < MAXBASE:(ARG:0):0 / 2
	LOCAL:5 = 50
	LOCAL:6 = 51
ELSE
	LOCAL:5 = 0
	LOCAL:6 = 0
ENDIF
IF BASE:(ARG:0):1 <= MAXBASE:(ARG:0):1 / 2
	LOCAL:7 = 52
	LOCAL:8 = 53
ELSE
	LOCAL:7 = 0
	LOCAL:8 = 0
ENDIF
IF BASE:(ARG:0):3 <= 0
	LOCAL:9 = 54
ELSE
	LOCAL:9 = 0
ENDIF

IF LOCAL:5 || LOCAL:7 || LOCAL:9 || LOCAL:10
	PRINTFORM %CALLNAME:(ARG:0)%は
	SIF LOCAL:5
		PRINTFORM 体力(HP)を削られ、
	SIF LOCAL:7
		PRINTFORM 気力(MP)を削られ、
	SIF LOCAL:9
		PRINTFORM 裸にされ、
	SIF TALENT:(ARG:0):130 >= 1
		PRINTFORM 母乳のせいで胸が張って
	PRINTFORML 困っているようだ…
ENDIF
$INPUT_LOOP
PRINTFORML 
PRINTFORML どうしますか？
SIF TALENT:(ARG:0):130 >= 1
	PRINTFORML [13] 乳搾り
PRINTFORML [18] 視姦する
PRINTFORML [603] クイーンのB攻撃
PRINTFORML [612] ガーディアンのB攻撃
PRINTFORML [618] バイオプラントのB攻撃
PRINTFORML [622] リビングバインのB攻撃
PRINTFORML [625] スカーレットバインのB攻撃
PRINTFORML [634] オクトパスのB攻撃
PRINTFORML [636] オクトパスのB吸収攻撃
PRINTFORML [638] クラーケンのB攻撃
PRINTFORML [640] クラーケンのB吸収攻撃
PRINTFORML [652] スライムのB攻撃
PRINTFORML [656] ブロブのB攻撃
PRINTFORML [668] シェイプシフターのB攻撃
PRINTFORML [674] ドッペルゲンガーのB攻撃
PRINTFORML [680] ヒュプノのB攻撃
PRINTFORML [685] フェアリーイーターのB吸収攻撃
PRINTFORML [706] ジェリーフィッシュのB攻撃
PRINTFORML [966] ショゴスセルのB攻撃

PRINTFORML 
PRINTFORML [900] 解答する
PRINTFORML [ 0] 終わる


INPUT

IF RESULT == 0
	RETURN
;母乳飲み
ELSEIF RESULT == 13 && TALENT:(ARG:0):130 >= 1
	;成功条件 好感度、レズ中毒、母乳のたまり具合
	TFLAG:63 = 1
	CALL PRINT_MESSAGE(ARG:0, 144, 7, CALLNAME:1, CALLNAME:(ARG:0))
	BASE:1:0 += MAXBASE:1:0 / 5
	BASE:1:1 += MAXBASE:1:1 / 10
	CALL PRINT_MESSAGE(ARG:0, 144, 12, CALLNAME:1, CALLNAME:(ARG:0))

	;膨乳は収まる
	SIF CFLAG:(ARG:0):506 > 10
		CFLAG:(ARG:0):506 -= RAND:10

	CALL ADD_ABL_EXP_PT(2, 700)
	CALL ADD_ABL_EXP_PT(13, 3 + RAND:5)
	GOTO INPUT_LOOP
;視姦
ELSEIF RESULT == 18
	TFLAG:63 = 0
	CALL DAMAGE_COMMON(ARG:0, 2, 8000 + RAND:4001, 100)
	TFLAG:63 = 1
	CALL DAMAGE_COMMON(ARG:0, 2, 8000 + RAND:4001, 100)
	TFLAG:63 = 2
	CALL DAMAGE_COMMON(ARG:0, 2, 8000 + RAND:4001, 100)
	TFLAG:63 = 3
	CALL DAMAGE_COMMON(ARG:0, 2, 8000 + RAND:4001, 100)
	CALL PRINT_MESSAGE(ARG:0, 507, 1, CALLNAME:1, CALLNAME:(ARG:0))
	GOTO INPUT_LOOP
ELSEIF RESULT == 603
	CALL ENEMY_ATTACK(ARG:0,RESULT,1)
	GOTO INPUT_LOOP
ELSEIF RESULT == 612
	CALL ENEMY_ATTACK(ARG:0,RESULT,3)
	GOTO INPUT_LOOP
ELSEIF RESULT == 618
	CALL ENEMY_ATTACK(ARG:0,RESULT,4)
	GOTO INPUT_LOOP
ELSEIF RESULT == 622
	CALL ENEMY_ATTACK(ARG:0,RESULT,5)
	GOTO INPUT_LOOP
ELSEIF RESULT == 625
	CALL ENEMY_ATTACK(ARG:0,RESULT,6)
	GOTO INPUT_LOOP
ELSEIF RESULT == 634
	CALL ENEMY_ATTACK(ARG:0,RESULT,9)
	GOTO INPUT_LOOP
ELSEIF RESULT == 636
	CALL ENEMY_ATTACK(ARG:0,RESULT,9)
	GOTO INPUT_LOOP
ELSEIF RESULT == 638
	CALL ENEMY_ATTACK(ARG:0,RESULT,10)
	GOTO INPUT_LOOP
ELSEIF RESULT == 640
	CALL ENEMY_ATTACK(ARG:0,RESULT,10)
	GOTO INPUT_LOOP
ELSEIF RESULT == 652
	CALL ENEMY_ATTACK(ARG:0,RESULT,13)
	GOTO INPUT_LOOP
ELSEIF RESULT == 656
	CALL ENEMY_ATTACK(ARG:0,RESULT,14)
	GOTO INPUT_LOOP
ELSEIF RESULT == 668
	CALL ENEMY_ATTACK(ARG:0,RESULT,17)
	GOTO INPUT_LOOP
ELSEIF RESULT == 674
	CALL ENEMY_ATTACK(ARG:0,RESULT,18)
	GOTO INPUT_LOOP
ELSEIF RESULT == 680
	CALL ENEMY_ATTACK(ARG:0,RESULT,98)
	GOTO INPUT_LOOP
ELSEIF RESULT == 685
	CALL ENEMY_ATTACK(ARG:0,RESULT,31)
	GOTO INPUT_LOOP
ELSEIF RESULT == 706
	CALL ENEMY_ATTACK(ARG:0,RESULT,54)
	GOTO INPUT_LOOP
ELSEIF RESULT == 966
	CALL ENEMY_ATTACK(ARG:0,RESULT,35)
	GOTO INPUT_LOOP
ELSEIF RESULT == 900
	;キャラ選択
	CALL MINIGAME_CHARA_SELECT
	LOCAL:1 = RESULT
	;キャンセルされた場合は最初から
	SIF LOCAL:1 == 0
		RESTART
	IF NO:(ARG:0) == LOCAL:1
		PRINTFORMW %CALLNAME:(ARG:0)%は%CSVNAME(NO:(ARG:0))%だった！
		CALLNAME:(ARG:0) = %CSVNAME(NO:(ARG:0))%
	ELSE
		CALL MINIGAME_PENALTY(ARG:0)
	ENDIF
ELSE
	REUSELASTLINE 入力値が不正です。再入力してください
	GOTO INPUT_LOOP
ENDIF




;キャラクターを1人選択して、キャラ番号を返す　キャンセル時は0を返す
@MINIGAME_CHARA_SELECT
;LOCALリスト
;0	LOOP
;1	TEMP
;2	
;3	
;4	選択予定キャラ
;5	ページ数
;6	ループで使用


;初期化
;ページ数は記憶しない方が使いやすそうなので、初期化しない（ゲーム開始時の初期化のみ）
;LOCAL:5 = 0
LOCAL:6 = 0

$START


DRAWLINE
PRINTFORM キャラクターを選択してください  ( )内表記は　(戦闘素質/速度)    
DRAWLINE

;全体表示
FOR LOCAL:6, (11+30*LOCAL:5), (41+30*LOCAL:5)
	SIF (LOCAL:6 % 3 == 2) && (LOCAL:6 != (11+30*LOCAL:5))
		PRINTL 
	IF LOCAL:6 > (FLAG:2 + 10)
		PRINTC  
		CONTINUE
	ENDIF
	RESETCOLOR
	PRINTFORMLC [{LOCAL:6,3}] %CSVNAME(LOCAL:6 - 10, 0),16,LEFT% ({CSVABL(LOCAL:6 - 10, 98, 0), 3}/{CSVABL(LOCAL:6 - 10, 97, 0), 3})
	RESETCOLOR
NEXT
PRINTL 
DRAWLINE
PRINTLC [7] 前のページ
PRINTFORMLC             Page({LOCAL:5 + 1}/{(FLAG:2 - 1)/30 + 1})
PRINTC [9] 次のページ
PRINTL 
PRINTL [0] 戻る

$INPUT_LOOP
INPUT

IF RESULT == 0
	RETURN 0
ELSEIF RESULT == 7
	;前ページへ
	LOCAL:5 -= 1
	SIF LOCAL:5 < 0
		LOCAL:5 = (FLAG:2 - 1) / 30
ELSEIF RESULT == 9
	;次ページへ
	LOCAL:5 += 1
	SIF LOCAL:5 > ((FLAG:2 - 1) / 30)
		LOCAL:5 = 0
ELSEIF RESULT >= 11 && RESULT <= (FLAG:2 + 10)
	;直接指定
	LOCAL:4 = RESULT - 10
	;特に確認とか処理無しで、そのまま返す
	RETURN LOCAL:4
ELSE
	REUSELASTLINE 入力値が不正です。再入力してください
	GOTO INPUT_LOOP
ENDIF

GOTO START
