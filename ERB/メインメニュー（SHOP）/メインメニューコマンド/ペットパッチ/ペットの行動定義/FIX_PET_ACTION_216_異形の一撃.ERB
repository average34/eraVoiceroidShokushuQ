;異形の一撃
;敵の能力が威力や命中率になる
;……という仕様だったが、そのせいでPET_BATTLE.ERBでやってることを全部ここでやるはめになったというトンデモスキル。
@FIX_PET_ACTION_216
#DIM LCOUNT
VARSET LOCAL
FOR LCOUNT, 1, TFLAG:15 + 1
	;死体殴り防止
	SIF DA:(TFLAG:LCOUNT):1 <= 0
		CONTINUE
	LOCAL:LCOUNT = RAND:100
NEXT
MAX LOCAL:1, LOCAL:2, LOCAL:3, LOCAL:4, LOCAL:5, LOCAL:6, LOCAL:7, LOCAL:8, LOCAL:9, LOCAL:10
FOR LCOUNT, 1, TFLAG:15 + 1
	IF LOCAL:LCOUNT == RESULT
		PET:51 = TFLAG:LCOUNT
		RETURN
	ENDIF
NEXT

;威力
PET:90 = DA:(PET:51):5
;命中率
PET:91 = DA:(PET:51):9
;種別 0攻撃　1回復HP 2回復MP　3回復TP
PET:92 = 0
;対象全体フラグ
PET:93 = 0
;行動の回数　0なら1
PET:94 = 1
;特殊フラグ　コレに応じたEXTRA_PET_ACTIONが呼ばれるます
PET:98 = 0
;メイン処理回避フラグ　これ立てる場合は全部関数内で処理つくること。
PET:99 = 1
CALL PRINT_MESSAGE(-1, 400)

VARSET LOCAL

LOCAL:1 = (25 + PET:10 / 2) * PET:90
LOCAL:1 = LOCAL:1 * (90 + RAND:11 + RAND:11) / 1000
LOCAL:3 = PET:32 * PET:91 / 100
PRINTFORML 命中率:{LOCAL:3}％
IF RAND:100 > LOCAL:3
	PRINTFORML 外した！
	RETURN 1
ENDIF
;攻撃回数が0なら1に修正
SIF PET:94 == 0
	PET:94 = 1
;攻撃回数だけループ
FOR LCOUNT, 0, PET:94
	PRINTFORM %SAVESTR:(PET:51)%に
	SETCOLOR 0x70FFFF
	PRINTFORM {LOCAL:1}
	RESETCOLOR
	PRINTFORML のダメージ！
	DA:(PET:51):1 -= LOCAL:1
	;ダメージによる拘束キャラ救出判定
	IF DA:(PET:51):1 > 0 && (DA:(PET:51):10 || DA:(PET:51):20)
		LOCAL:4 = 2 + LIMIT((LOCAL * 51 / DA:(PET:51):2), 1, 10) + LIMIT((DA:(PET:51):1 * 10 / DA:(PET:51):2), 0, 5)
		IF RAND:100 < LOCAL:4
			CALL STATUS_RENEW_RELEASE(DA:(PET:51):10, 0, 2)
			CALL STATUS_RENEW_RELEASE(DA:(PET:51):20, 0, 2)
		ENDIF
	ENDIF
	SIF PET:98
		TRYCALLFORM PET_EXTRA_ACTION_{PET:98}
NEXT