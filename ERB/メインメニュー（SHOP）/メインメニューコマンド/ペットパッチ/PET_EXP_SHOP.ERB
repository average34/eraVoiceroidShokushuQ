;Ver1.2に伴い、中身を書き換え。レートがゆるめに。それでも渋いけど。
;バグ指摘してくださった方ありがとうございました。
;ああしてテンキーに対応するとPRINTBUTTON使う意味が特にないので（かといってアレ以外の方法も特に思いつかないので、）、PRINTFORMLにしてます。
@PET_EXP_SHOP
#DIM LCOUNT
VARSET LOCAL
DRAWLINE
PRINTFORML 栄養を消費し、アイテムやサービスを受けられます
PRINTFORML 何をしますか？ 栄養:{PET:21}
PRINTL
;----------------
;リスト描画処理
;----------------
;個別のもの
;栄養足りてないときに灰色で描く処理をいちいち作るのがめんどくさいのでFOR化
PRINTFORML ----サービス----
FOR LCOUNT, 1, 6
	SELECTCASE LCOUNT
		CASE 1
			LOCAL:LCOUNT = 100
		CASE 2
			LOCAL:LCOUNT = 100
		CASE 3
			LOCAL:LCOUNT = 100
		CASE 4
			LOCAL:LCOUNT = 150
		CASE 5
			LOCAL:LCOUNT = 50
ENDSELECT
LOCAL:LCOUNT = LOCAL:LCOUNT * (100 + PET_SUBMISSION_PT() / GET_MEMBER_SUM()) / 100
SIF LOCAL:LCOUNT && !PET_EXP_ENOUGH(LOCAL:LCOUNT)
	SETCOLOR 0X333333
SELECTCASE LCOUNT
	CASE 1
		PRINTFORML [ 1] - %"回復",15,LEFT% {LOCAL:1}
	CASE 2
		PRINTFORML [ 2] - %"服を着る",15,LEFT% {LOCAL:2}
	CASE 3
		IF FLAG:520
			PRINTFORML [ 3] - %"武器入手",15,LEFT% {LOCAL:3}
		ENDIF
	CASE 4
		PRINTFORML [ 4] - %"腹を満たす",15,LEFT% {LOCAL:4}
	CASE 5
		PRINTFORML [ 5] - %"目を覚ます",15,LEFT% {LOCAL:5}
ENDSELECT
RESETCOLOR
NEXT
PRINTFORML
PRINTFORML ----生産----
;今後生産できるアイテムを追加する場合、まずそのIDのCASEを追加
;んでLOCAL:LCOUNTにそのレートを書き加えてください。
FOR LCOUNT, 50, 72
	SELECTCASE LCOUNT
		CASE 50
			LOCAL:LCOUNT = 75
		CASE 51
			LOCAL:LCOUNT = 150
		CASE 52
			LOCAL:LCOUNT = 100
		CASE 53
			LOCAL:LCOUNT = 200
		CASE 54
			LOCAL:LCOUNT = 150
		CASE 55
			LOCAL:LCOUNT = 50
		CASE 56
			LOCAL:LCOUNT = 50
		CASE 57
			LOCAL:LCOUNT = 150
		CASE 58
			LOCAL:LCOUNT = 250
		CASE 59
			LOCAL:LCOUNT = 50
		CASE 61
			LOCAL:LCOUNT = 500
		CASE 62
			LOCAL:LCOUNT = 500
		CASE 63
			LOCAL:LCOUNT = 500
		CASE 70
			LOCAL:LCOUNT = 70
		CASE 71
			LOCAL:LCOUNT = 100
	ENDSELECT
	LOCAL:LCOUNT = LOCAL:LCOUNT * (100 + PET_SUBMISSION_PT() / GET_MEMBER_SUM()) / 100
	IF LOCAL:LCOUNT && (GET_ITEM_MAX(LCOUNT) > -1 && ITEM:LCOUNT < GET_ITEM_MAX(LCOUNT)|| GET_ITEM_MAX(LCOUNT) <= 0) && PET_EXP_ENOUGH(LOCAL:LCOUNT)
			PRINTFORML [{LCOUNT,2,RIGHT}] - %ITEMNAME:LCOUNT,15,LEFT% {LOCAL:LCOUNT}
	ELSEIF LOCAL:LCOUNT && !PET_EXP_ENOUGH(LOCAL:LCOUNT)
			SETCOLOR 0X333333
			PRINTFORML [{LCOUNT,2,RIGHT}] - %ITEMNAME:LCOUNT,15,LEFT% {LOCAL:LCOUNT}
			RESETCOLOR
	ELSEIF LOCAL:LCOUNT && GET_ITEM_MAX(LCOUNT) <= ITEM:LCOUNT
			SETCOLOR 0X333333
			PRINTFORML [{LCOUNT,2,RIGHT}] - %ITEMNAME:LCOUNT,15,LEFT%は既に十分持っている
			RESETCOLOR
	ENDIF
NEXT
PRINTL
PRINTFORML [ 0] - 戻る
;----------------
;リスト描画処理終わり
;----------------

$INPUT_LOOP
INPUT

;----------------
;各処理
;----------------

LOCAL:100 = RESULT

IF LOCAL:(LOCAL:100) && PET_EXP_ENOUGH(LOCAL:(LOCAL:100)) == 0
	REUSELASTLINE 栄養が足りていないようだ……
	GOTO INPUT_LOOP
ELSEIF GET_ITEM_MAX(LOCAL:100) >= 0 && ITEM:(LOCAL:100) >= GET_ITEM_MAX(LOCAL:100)
	REUSELASTLINE %ITEMNAME:(LOCAL:100)%は既に十分持っているようだ……
	GOTO INPUT_LOOP
ELSEIF LOCAL:100 == 0
	RETURN
ELSEIF !LOCAL:(LOCAL:100)
	REUSELASTLINE 不正入力です。正しい値を入力してください。
	GOTO INPUT_LOOP
ENDIF



IF LOCAL:(LOCAL:100)  && PET_EXP_ENOUGH(LOCAL:(LOCAL:100))
	IF LOCAL:100 == 1
		PRINTFORML 誰が回復しますか？
		;PTメンバー表示
		PRINTFORM [1] 
			CALL SHOW_SIMPLE_STATUS(1)
		IF FLAG:10
			PRINTFORM [2] 
			CALL SHOW_SIMPLE_STATUS(FLAG:10)
		ENDIF
		IF FLAG:11
			PRINTFORM [3] 
			CALL SHOW_SIMPLE_STATUS(FLAG:11)
		ENDIF
		PRINTL [0] 戻る
		$INPUT_LOOP_2
		INPUT
		IF RESULT == 1 || (RESULT == FLAG:10 && FLAG:10) || (RESULT == FLAG:11 && FLAG:11)
			PRINTFORM %CALLNAME:RESULT%の
			LOCAL:103 = RAND:100
			SELECTCASE LOCAL:103
				CASE 0 TO 50
					PRINTFORM HP
				CASE 51 TO 80
					PRINTFORM EP
				CASE 81 TO 99
					PRINTFORM MP
			ENDSELECT
			PRINTFORMW が、全快した！
			SELECTCASE LOCAL:103
				CASE 0 TO 50
					BASE:RESULT:0 = MAXBASE:RESULT:0
				CASE 51 TO 80
					BASE:RESULT:0 = MAXBASE:RESULT:0
				CASE 81 TO 99
					BASE:RESULT:0 = MAXBASE:RESULT:0
			ENDSELECT
		ELSEIF RESULT == 0
			RESTART
		ELSE
			REUSELASTLINE 不正入力です。正しい値を入力してください。
			GOTO INPUT_LOOP_2
		ENDIF
	ELSEIF LOCAL:100 == 2
		PRINTFORML 誰が服を着ますか？
		;PTメンバー表示
		PRINTFORM [1] 
			CALL SHOW_SIMPLE_STATUS(1)
		IF FLAG:10
			PRINTFORM [{FLAG:10}] 
			CALL SHOW_SIMPLE_STATUS(FLAG:10)
		ENDIF
		IF FLAG:11
			PRINTFORM [{FLAG:11}] 
			CALL SHOW_SIMPLE_STATUS(FLAG:11)
		ENDIF
		PRINTL [0] 戻る
		$INPUT_LOOP_3
		INPUT
		LOCAL:101 = RESULT
		IF LOCAL:101 == 1 || (LOCAL:101 == FLAG:10 && FLAG:10) || (LOCAL:101 == FLAG:11 && FLAG:11)
			CALL CLOTH_TYPE_1(LOCAL:101)
			BASE:(LOCAL:101):3 = MAXBASE:(LOCAL:101):3
			SIF CFLAG:(LOCAL:101):501 == 15
				CFLAG:(LOCAL:101):47 = 1
			CALL PRINT_MESSAGE(LOCAL:101, 36, 54, CALLNAME:(LOCAL:101), "")
			CALL SYOKUSYU_HUKU(LOCAL:101)
		ELSEIF LOCAL:101 == 0
			RESTART
		ELSE
			REUSELASTLINE 不正入力です。正しい値を入力してください。
			GOTO INPUT_LOOP_3
		ENDIF
	ELSEIF LOCAL:100 == 3 && FLAG:520 == 1
		PRINTFORML 誰に武器を与えますか？
		;PTメンバー表示
		IF FLAG:520 == 1 || FLAG:520 == 2
			PRINTFORM [1] 
				CALL SHOW_SIMPLE_STATUS(1)
		ENDIF
		IF FLAG:520 == 1 || FLAG:520 == 3
			IF FLAG:10
				PRINTFORM [{FLAG:10}] 
				CALL SHOW_SIMPLE_STATUS(FLAG:10)
			ENDIF
			IF FLAG:11
				PRINTFORM [{FLAG:11}] 
				CALL SHOW_SIMPLE_STATUS(FLAG:11)
			ENDIF
		ELSEIF FLAG:10 == 0 && FLAG:520 == 3
			PRINTFORML 与えられるキャラクターがいません
		ENDIF
		PRINTL [0] 戻る
		$INPUT_LOOP_4
		INPUT
		LOCAL:101 = RESULT
		IF LOCAL:101 == 1 || (LOCAL:101 == FLAG:10 && FLAG:10) || (LOCAL:101 == FLAG:11 && FLAG:11)
			PRINTFORM %CALLNAME:(LOCAL:101)%は服を脱ぐと、
			SIF ABL:(LOCAL:101):射精中毒
				PRINTFORM 心なしか頬を上気させ、
			PRINTFORML 横たわった……
			PRINTFORML 無防備な%CALLNAME:(LOCAL:101)%に%PETNAME%が触手を殺到させる！
			FOR LCOUNT, 0, (RAND:5 + (2 - PET_STARVE()) + 3)
				TFLAG:63 = 2
				CALL PRINT_MESSAGE(LOCAL:101, 200, 148, CALLNAME:(LOCAL:101), "", 1)
				LOCAL:104 = CALC_SENSITIVITY(1, TFLAG:63, LOCAL:1)
				CALL DAMAGE_COMMON(LOCAL:101, 2, LOCAL:104 * 7 * (TALENT:(LOCAL:101):103 + 2) * (TALENT:(LOCAL:101):77 + 1), 500)
			NEXT
			PRINTFORML %CALLNAME:(LOCAL:101)%は【ふたなり】になってしまった！
			CALL PRINT_MESSAGE(LOCAL:101, 200, 148, CALLNAME:(LOCAL:101), "", 3)
			CFLAG:(LOCAL:101):42 += 1 + RAND:4 + RAND:3 + RAND:2
			IF RAND:4 == 0 && TALENT:(LOCAL:101):103 <= 2
				PRINTFORMW %CALLNAME:(LOCAL:101)%の身体の様子がおかしい。どうやら、触手からの責めによって体質が書き換えられてしまったようだ…
				; 寸前でふたなり化しているので分岐の必要は無いと思うが、一応別の箇所と同一処理
				IF GET_PENIS(LOCAL:101)
					PRINTFORMW %CALLNAME:(LOCAL:101)%の陰茎が少し敏感になった
				ELSE
					PRINTFORMW %CALLNAME:(LOCAL:101)%のクリトリスが少し敏感になった
				ENDIF
				TALENT:(LOCAL:101):103 += 1
			ENDIF
		ELSEIF LOCAL:101 == 0
			RESTART
		ELSE
			REUSELASTLINE 不正入力です。正しい値を入力してください。
			GOTO INPUT_LOOP_4
		ENDIF
	ELSEIF LOCAL:100 == 4
		PRINTFORML 誰のお腹を満たしますか？
		;PTメンバー表示
		PRINTFORM [1] 
			CALL SHOW_SIMPLE_STATUS(1)
		IF FLAG:10
			PRINTFORM [{FLAG:10}] 
			CALL SHOW_SIMPLE_STATUS(FLAG:10)
		ENDIF
		IF FLAG:11
			PRINTFORM [{FLAG:11}] 
			CALL SHOW_SIMPLE_STATUS(FLAG:11)
		ENDIF
		PRINTL [0] 戻る
		$INPUT_LOOP_5
		INPUT
		LOCAL:101 = RESULT
		IF LOCAL:101 == 1 || (LOCAL:101 == FLAG:10 && FLAG:10) || (LOCAL:101 == FLAG:11 && FLAG:11)
			CALL PRINT_MESSAGE(LOCAL:101, 200, 160, CALLNAME:1, "", 2, 0)
			FOR LOCAL:0, 0, 20
				TFLAG:63 = 3
				CALL DAMAGE_COMMON(LOCAL:101, 2, 30*(RAND:5+10)* (TALENT:(LOCAL:101):(101+TFLAG:63) + 2), 50)
			NEXT
			CALL PRINT_MESSAGE(LOCAL:101, 200, 160, CALLNAME:1, "", 2, 1)
			IF CFLAG:(LOCAL:101):22 == 0
				CALL RANDOM_PARASITE(LOCAL:101, 1, 1)
			ENDIF
		ELSEIF LOCAL:101 == 0
			RESTART
		ELSE
			REUSELASTLINE 不正入力です。正しい値を入力してください。
			GOTO INPUT_LOOP_5
		ENDIF
	ELSEIF LOCAL:100 == 5
		PRINTFORMW %PETNAME%が起こしてくれるというので、%CALLNAME:1%%TACHI()%は厚意に甘えることにした……
		LOCAL:101 = RAND:5
		TRYCALLFORM FIX_PT_ACTION_{54 + LOCAL:101}(1)
		CFLAG:1:50 = 54 + LOCAL:101
		SIF PET:0 == 98
			CFLAG:1:43 = 0
		IF RAND:10
			;満腹度が低いほど回数が増える
			FOR LCOUNT, 0, RAND:(LIMIT((100 - PET:10) / 20, 1, 5)) + 1
				CALL PET_RAPE(1)
			NEXT
		ELSE
			;極希に大暴走
			SETCOLOR 255, 0, 0
			PRINTFORML 大暴走だ！！
			RESETCOLOR
			FOR LCOUNT, 0, 10
				CALL PET_RAPE(1)
			NEXT
		ENDIF
		IF FLAG:10
			LOCAL:101 = RAND:5
			TRYCALLFORM FIX_PT_ACTION_{54 + LOCAL:101}(FLAG:10)
			CFLAG:(FLAG:10):50 = 54 + LOCAL:101
			SIF PET:0 == 98
				CFLAG:(FLAG:10):43 = 0
			IF RAND:10
				;満腹度が低いほど回数が増える
				FOR LCOUNT, 0, RAND:(LIMIT((100 - PET:10) / 20, 1, 5)) + 1
					CALL PET_RAPE(FLAG:10)
				NEXT
			ELSE
				;極希に大暴走
				SETCOLOR 255, 0, 0
				PRINTFORML 大暴走だ！！
				RESETCOLOR
				FOR LCOUNT, 0, 10
					CALL PET_RAPE(FLAG:10)
				NEXT
			ENDIF
		ENDIF
		IF FLAG:11
			LOCAL:101 = RAND:5
			TRYCALLFORM FIX_PT_ACTION_{54 + LOCAL:101}(FLAG:11)
			CFLAG:(FLAG:11):50 = 54 + LOCAL:101
			SIF PET:0 == 98
				CFLAG:(FLAG:11):43 = 0
			IF RAND:10
				;満腹度が低いほど回数が増える
				FOR LCOUNT, 0, RAND:(LIMIT((100 - PET:10) / 20, 1, 5)) + 1
					CALL PET_RAPE(FLAG:11)
				NEXT
			ELSE
				;極希に大暴走
				SETCOLOR 255, 0, 0
				PRINTFORML 大暴走だ！！
				RESETCOLOR
				FOR LCOUNT, 0, 10
					CALL PET_RAPE(FLAG:11)
				NEXT
			ENDIF
		ENDIF
		PRINTFORML %PETNAME%にさんざん犯され、%CALLNAME:1%%TACHI()%は目が覚めた！
		FLAG:7 = 0
			LOCAL:101 = RAND:100
			SIF FLAG:10
				LOCAL:102 = RAND:100
			SIF FLAG:11
				LOCAL:103 = RAND:100
			MAX LOCAL:101, LOCAL:102, LOCAL:103
			IF RESULT == LOCAL:101
				LOCAL:104 = 1
			ELSEIF RESULT == LOCAL:102
				LOCAL:104 = FLAG:10
			ELSEIF RESULT == LOCAL:103
				LOCAL:104 = FLAG:11
			ENDIF
			LOCAL:105 = RAND:5
		IF RAND:100> 70 && TALENT:(LOCAL:104):(74 + LOCAL:105) == 0
			PRINTFORML 同時に、%CALLNAME:(LOCAL:104)%が何かに目覚めてしまったようだ……
			PRINTFORML %CALLNAME:(LOCAL:104)%は[%TALENTNAME:(74 + LOCAL:105)%]を得た
			TALENT:(LOCAL:104):(74 + LOCAL:105) = 1
		ENDIF
	;アイテム生産汎用処理
	ELSE
		CALL ADD_ITEM(LOCAL:100, 1, 1)
	ENDIF
PRINTW
ENDIF
PET:21 -= LOCAL:(LOCAL:100)
CALL LIMIT_PET_STATUS
RESTART
