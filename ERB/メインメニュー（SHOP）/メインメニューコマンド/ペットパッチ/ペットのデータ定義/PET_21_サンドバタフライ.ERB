;サンドバタフライ
@SET_PET_DATA_21
PET:30 = 1
PET:31 = 60
PET:32 = 85
PET:33 = 3

;行動ルーチン
@SELECT_PET_ACTION_21
SELECTCASE PET:1
	CASE 1, 2, 3
		SELECTCASE RAND:100 + 1
			CASE 1 TO 25
				PET:50 = 100
			CASE 26 TO 50
				PET:50 = 101
			CASE 51 TO 85
				PET:50 = 105
			CASEELSE
				PET:50 = 106
		ENDSELECT
	CASE 4, 5
		SELECTCASE RAND:100 + 1
			CASE 1 TO 20
				PET:50 = 100
			CASE 21 TO 40
				PET:50 = 101
			CASE 41 TO 60
				PET:50 = 125
			CASE 61 TO 80
				PET:50 = 126
			CASEELSE
				PET:50 = 206
		ENDSELECT
	CASE 6, 7
		SELECTCASE RAND:100 + 1
			CASE 1 TO 15
				PET:50 = 100
			CASE 16 TO 30
				PET:50 = 101
			CASE 31 TO 55
				PET:50 = 125
			CASE 56 TO 70
				PET:50 = 126
			CASEELSE
				PET:50 = 206
		ENDSELECT
ENDSELECT


;レイプ行動の決定
@SELECT_PET_RAPE_ACTION_21
#DIMS PET_NAME_NF	;NFしたペットの名前
#DIM PET_NFLV,100	;変数番号→NFされたキャラID、格納数→NF進行度
#DIM PET_NFDATE,100	;変数番号→NFされたキャラID、格納数→最後にNFされた日
#DIM PET_NFTIME,100	;変数番号→NFされたキャラID、格納数→最後にNFされた時間
;LOCAL
;0	NFフラグ

;前回ペットにNFされていて、ペットの名前とNFされた日時、前回と今回で全て一致
IF PET_NFLV:(PET:51) == 1 && PETNAME == PET_NAME_NF && DAY == PET_NFDATE:(PET:51) && TIME == PET_NFTIME:(PET:51)
	PET_NFLV:(PET:51) = 2
ELSE
	PET_NFLV:(PET:51) = 0
ENDIF

LOCAL:0 = 0
TRYCALL CALC_NIPPLE_FUCK(PET:51, 4)
LOCAL:0 = RESULT:0
$BRANCH

SELECTCASE RAND:100 + 1
	CASE 1 TO 25
		PET:50 = 1876
	CASE 26 TO 55
		PET:50 = 956
	CASE 56 TO 60
		PET:50 = 957
	CASE 61 TO 65
		;NF可でないなら再選択
		IF LOCAL:0 == 0
			GOTO BRANCH
		ENDIF
		PET:50 = 1201
		;B寄生攻撃は拡張乳腺+以上が必要
		IF FLAG:516 > 0 && TALENT:(PET:51):162 > 1
			PET_NAME_NF = %PETNAME%
			PET_NFDATE:(PET:51) = DAY
			PET_NFTIME:(PET:51) = TIME
			SIF PET_NFLV:(PET:51) == 0
				PET_NFLV:(PET:51) = 1
		ENDIF
	CASE 66 TO 85
		PET:50 = 958
	CASE 86 TO 90
		PET:50 = 959
	CASE 91 TO 95
		PET:50 = 1000
	CASEELSE
		PET:50 = 960
ENDSELECT
;B寄生攻撃フラグ
IF PET_NFLV:(PET:51) == 2
	PET:50 = 1202
	PET_NFLV:(PET:51) = 0
ENDIF

;行動対象の決定　
;速い奴
@PET_TARGET_RATE_21
#DIM LCOUNT
VARSET LOCAL
FOR LCOUNT, 1, TFLAG:15 + 1
	;死体殴り防止
	IF DA:(TFLAG:LCOUNT):1 <= 0
		LOCAL:LCOUNT = 0
		CONTINUE
	ENDIF
	LOCAL:LCOUNT = DA:(TFLAG:LCOUNT):9
NEXT
FOR LCOUNT, TFLAG:15 + 1, 11
	LOCAL:LCOUNT = 0
NEXT
MAX LOCAL:1, LOCAL:2, LOCAL:3, LOCAL:4, LOCAL:5, LOCAL:6, LOCAL:7, LOCAL:8, LOCAL:9, LOCAL:10
FOR LCOUNT, 1, TFLAG:15 + 1
	SIF LOCAL:LCOUNT == RESULT
		PET:51 = TFLAG:LCOUNT
NEXT


;レイプ対象の決定
;完全ランダム
@PET_RAPE_TARGET_RATE_21
VARSET LOCAL
LOCAL:0 = RAND:100
SIF FLAG:10
	LOCAL:1 = RAND:100
SIF FLAG:11
	LOCAL:2 = RAND:100
MAX LOCAL:0, LOCAL:1, LOCAL:2
IF RESULT == LOCAL:0
	PET:51 = 1
ELSEIF RESULT == LOCAL:1
	PET:51 = FLAG:10
ELSEIF RESULT == LOCAL:2
	PET:51 = FLAG:11
ENDIF