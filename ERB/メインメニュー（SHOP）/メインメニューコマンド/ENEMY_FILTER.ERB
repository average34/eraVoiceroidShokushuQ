;エネミーフィルター
;ここではフラグを立てるだけでREPOP.ERBなどの敵が出てくる処理で確定
@ENEMY_FILTER
;LOCAL
;0	ループ用
;1	ループ用
;
;3	敵種類数(敵No最大値)
;4	最終ページ
;5	ページ数
;6	非表示処理の確認用

;FLAG:527	種族フィルター （優先的に出現するもの）
;FLAG:536	種族フィルター （優先的に出現させなくするもの）
;FLAG:512	男フィルター (NPCにも使う可能性があるので別枠)



LOCAL:5 = 0

$START

PRINTFORML 自然出現するエネミーにフィルターを掛ける（除外する）ことができます。
;クイーンとかフィルターかけられないものは？？？表示
PRINTFORML 「×」のついているエネミーはフィルター適用中です。

DRAWLINE

;リスト部分を表示
CALL DEBUG_OUTPUT_ENEMY_LIST(LOCAL:5, 20, -2)
LOCAL:4 = RESULT:0
LOCAL:3 = RESULT:1
PRINTL 

PRINTFORM [1201] 個別フィルターを全て解除                    
PRINTFORML [1202] 基本モンスターのみ出現するようにする

;各種族のフィルター
PRINTFORML 
PRINTFORML ※ 以下は種族ごとにまとめたフィルターです。上記個別フィルターとは別に管理されます。
IF (FLAG:527 & 1) == 0
	IF FLAG:536 & 1
		PRINTFORMLC [1211] × 女性系
	ELSE
		PRINTFORMLC [1211]    女性系
	ENDIF
ENDIF
IF (FLAG:527 & 2) == 0
	IF FLAG:536 & 2
		PRINTFORMLC [1212] × 植物系
	ELSE
		PRINTFORMLC [1212]    植物系
	ENDIF
ENDIF
IF (FLAG:527 & 4) == 0
	IF FLAG:536 & 4
		PRINTFORMLC [1213] × 動物系
	ELSE
		PRINTFORMLC [1213]    動物系
	ENDIF
ENDIF

PRINTFORML 

IF (FLAG:527 & 8) == 0
	IF FLAG:536 & 8
		PRINTFORMLC [1214] × 丸呑系
	ELSE
		PRINTFORMLC [1214]    丸呑系
	ENDIF
ENDIF
IF (FLAG:527 & 16) == 0
	IF FLAG:536 & 16
		PRINTFORMLC [1215] × 海産系
	ELSE
		PRINTFORMLC [1215]    海産系
	ENDIF
ENDIF
IF (FLAG:527 & 32) == 0
	IF FLAG:536 & 32
		PRINTFORMLC [1216] × ローパー系
	ELSE
		PRINTFORMLC [1216]    ローパー系
	ENDIF
ENDIF

PRINTFORML 

IF (FLAG:527 & 64) == 0
	IF FLAG:536 & 64
		PRINTFORMLC [1217] × スライム系
	ELSE
		PRINTFORMLC [1217]    スライム系
	ENDIF
ENDIF
IF (FLAG:527 & 256) == 0
	IF FLAG:536 & 256
		PRINTFORMLC [1218] × 罠系
	ELSE
		PRINTFORMLC [1218]    罠系
	ENDIF
ENDIF
;野郎のみ別フラグによるフィルター
IF (FLAG:512 & 1) == 0
	PRINTFORMLC [1219] × 野郎
ELSE
	PRINTFORMLC [1219]    野郎
ENDIF

PRINTFORML 

IF (FLAG:542 & 1) == 0
	IF FLAG:543 & 1
		PRINTFORMLC [1220] × A系
	ELSE
		PRINTFORMLC [1220]    A系
	ENDIF
ENDIF
IF (FLAG:542 & 2) == 0
	IF FLAG:543 & 2
		PRINTFORMLC [1221] × B系
	ELSE
		PRINTFORMLC [1221]    B系
	ENDIF
ENDIF
IF (FLAG:542 & 4) == 0
	IF FLAG:543 & 4
		PRINTFORMLC [1222] × C系
	ELSE
		PRINTFORMLC [1222]    C系
	ENDIF
ENDIF

PRINTFORML 

IF (FLAG:542 & 8) == 0
	IF FLAG:543 & 8
		PRINTFORMLC [1223] × V系
	ELSE
		PRINTFORMLC [1223]    V系
	ENDIF
ENDIF

PRINTFORML 
PRINTFORML 
PRINTFORML [8000] フィルター全解放（図鑑なども全て開放されます）
PRINTFORML 

PRINTFORML [  0] 戻る


$INPUT_LOOP
INPUT

IF RESULT == 0
	RETURN
ELSEIF RESULT == 777
	;前ページへ
	LOCAL:5 -= 1
	SIF LOCAL:5 < 0
		LOCAL:5 = LOCAL:4
ELSEIF RESULT == 999
	;次ページへ
	LOCAL:5 += 1
	SIF LOCAL:5 > LOCAL:4
		LOCAL:5 = 0
ELSEIF RESULT == 8000
	;フィルター全解放
	FOR LOCAL:1, 5, LOCAL:3 + 1
		CALL SET_ENEMY_FILTER(LOCAL:1, 0)
		CALL REGISTER_ENEMY_WIKI(LOCAL:1)
	NEXT
ELSEIF RESULT > 4 && RESULT <= LOCAL:3 && GET_ENEMY_WIKI_REGISTERED(RESULT)
	;各敵に割り当てられている初登場フラグを利用
	;グローバルセーブで保存できるのでちょうどいい
	CALL SET_ENEMY_FILTER(RESULT, 2)
ELSEIF RESULT == 1201
	;個別フィルターを全て解除
	FOR LOCAL:1, 5, LOCAL:3 + 1
		CALL SET_ENEMY_FILTER(LOCAL:1, 0)
	NEXT
ELSEIF RESULT == 1202
	;基本モンスターのみ出現するようにする
	FOR LOCAL:1, 5, 20
		CALL SET_ENEMY_FILTER(LOCAL:1, 0)
	NEXT

	FOR LOCAL:1, 21, LOCAL:3 + 1
		IF ENEMY_NAME(LOCAL:1) != "バグ触手"
			CALL SET_ENEMY_FILTER(LOCAL:1, 1)
		ENDIF
	NEXT

;種族別フィルター
ELSEIF RESULT == 1211
	IF FLAG:536 & 1
		FLAG:536 -= 1
	ELSE
		FLAG:536 += 1
	ENDIF
ELSEIF RESULT == 1212
	IF FLAG:536 & 2
		FLAG:536 -= 2
	ELSE
		FLAG:536 += 2
	ENDIF
ELSEIF RESULT == 1213
	IF FLAG:536 & 4
		FLAG:536 -= 4
	ELSE
		FLAG:536 += 4
	ENDIF
ELSEIF RESULT == 1214
	IF FLAG:536 & 8
		FLAG:536 -= 8
	ELSE
		FLAG:536 += 8
	ENDIF
ELSEIF RESULT == 1215
	IF FLAG:536 & 16
		FLAG:536 -= 16
	ELSE
		FLAG:536 += 16
	ENDIF
ELSEIF RESULT == 1216
	IF FLAG:536 & 32
		FLAG:536 -= 32
	ELSE
		FLAG:536 += 32
	ENDIF
ELSEIF RESULT == 1217
	IF FLAG:536 & 64
		FLAG:536 -= 64
	ELSE
		FLAG:536 += 64
	ENDIF
ELSEIF RESULT == 1218
	IF FLAG:536 & 256
		FLAG:536 -= 256
	ELSE
		FLAG:536 += 256
	ENDIF
ELSEIF RESULT == 1219
	IF (FLAG:512 & 1)
		FLAG:512 -= 1
	ELSE
		FLAG:512 += 1
	ENDIF
ELSEIF RESULT == 1220
	IF FLAG:543 & 1
		FLAG:543 -= 1
	ELSE
		FLAG:543 += 1
	ENDIF
ELSEIF RESULT == 1221
	IF FLAG:543 & 2
		FLAG:543 -= 2
	ELSE
		FLAG:543 += 2
	ENDIF
ELSEIF RESULT == 1222
	IF FLAG:543 & 4
		FLAG:543 -= 4
	ELSE
		FLAG:543 += 4
	ENDIF
ELSEIF RESULT == 1223
	IF FLAG:543 & 8
		FLAG:543 -= 8
	ELSE
		FLAG:543 += 8
	ENDIF
ELSE
	REUSELASTLINE 入力値が不正です。再入力してください
	GOTO INPUT_LOOP
ENDIF

GOTO START

;NoがARG:0の敵をARG:1=0出現可能1出現不可2可否反転にする
@SET_ENEMY_FILTER(ARG:0, ARG:1)
IF ARG:1 == 1
	ENEMY_WIKI_REGISTERED:(ARG:0) |= 1
ELSEIF ARG:1 == 0
	ENEMY_WIKI_REGISTERED:(ARG:0) = ENEMY_WIKI_REGISTERED:(ARG:0) / 2 * 2
ELSEIF ARG:1 == 2
	ENEMY_WIKI_REGISTERED:(ARG:0) ^= 1
ENDIF

;NoがARGの敵がRESULT=0出現可能1出現不可のどっちであるかを返す
@IS_FILTERED_ENEMY(ARG)
#FUNCTION
RETURNF ENEMY_WIKI_REGISTERED:(ARG:0) & 1
