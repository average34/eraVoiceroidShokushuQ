;会話時プレゼント処理
;ARG:0	対象キャラ
;ARG:1	ドッペルフラグ
@PRESENT(ARG:0, ARG:1)

$SELECT_TYPE

DRAWLINE
PRINTL 渡すアイテムを選んでください
DRAWLINE
PRINTFORML [1] 消耗武器
PRINTFORML [2] 非消耗武器
PRINTFORML [3] アクセサリ
PRINTFORML [0] 戻る

$INPUT_LOOP2
INPUT

IF RESULT == 0
	RETURN
ELSEIF RESULT == 1
	CALL SELECT_LIMITED_WEAPON("渡すアイテムを選んでください")
	;この時点でRESULTには渡すアイテムIDが入っている
	IF RESULT <= 0
		;キャンセル
		GOTO SELECT_TYPE
	ENDIF
	LOCAL:3 = RESULT
	CALL ADD_ITEM(LOCAL:3, -1, 0)
	;残っている弾も渡す
	LOCAL:4 = GET_MAX_BULLET(LOCAL:3)
	IF ITEM:(GET_BULLET_ITEMID(LOCAL:3)) < LOCAL:4
		LOCAL:4 = ITEM:(GET_BULLET_ITEMID(LOCAL:3))
	ENDIF
	CALL ADD_ITEM(GET_BULLET_ITEMID(LOCAL:3), -LOCAL:4, 0)
	
	IF ARG:1 == 0
		CFLAG:(ARG:0):5 += EQUIP_POWER(LOCAL:3) / 3
		CFLAG:(ARG:0):121 += EQUIP_POWER(LOCAL:3) / 5
		IF CFLAG:(ARG:0):121 > 100
			CFLAG:(ARG:0):121 = 100
		ENDIF
		CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
		CALL PRINT_MESSAGE(ARG:0, 164, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
	ELSE
		CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3, 1)
		CALL PRINT_MESSAGE(ARG:0, 164, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3, 1)
	ENDIF
ELSEIF RESULT == 2
	CALL SELECT_WEAPON("渡すアイテムを選んでください")
	;この時点でRESULTには渡すアイテムIDが入っている
	IF RESULT <= 0
		;キャンセル
		GOTO SELECT_TYPE
	ENDIF
	LOCAL:3 = RESULT
	CALL ADD_ITEM(LOCAL:3, -1, 0)
	
	IF ARG:1 == 0
		CFLAG:(ARG:0):5 += EQUIP_POWER(LOCAL:3) / 2
		CFLAG:(ARG:0):121 += EQUIP_POWER(LOCAL:3) / 4
		IF CFLAG:(ARG:0):121 > 100
			CFLAG:(ARG:0):121 = 100
		ENDIF
		CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
		CALL PRINT_MESSAGE(ARG:0, 164, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
	ELSE
		CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3, 1)
		CALL PRINT_MESSAGE(ARG:0, 164, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3, 1)
	ENDIF
ELSEIF RESULT == 3
	CALL SELECT_ACCESSORY("渡すアイテムを選んでください")
	;この時点でRESULTには渡すアイテムIDが入っている
	IF RESULT <= 0
		;キャンセル
		GOTO SELECT_TYPE
	ENDIF
	LOCAL:3 = RESULT
	CALL ADD_ITEM(LOCAL:3, -1, 0)
	
	IF ARG:1 == 0
		LOCAL:4 = 0
		LOCAL:5 = 0
		LOCAL:6 = 0
		
		SELECTCASE LOCAL:3
			CASE 20
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 0
			CASE 21
				LOCAL:4 = 20
				LOCAL:5 = 13
				LOCAL:6 = 0
			CASE 22
				LOCAL:4 = 40
				LOCAL:5 = 25
				LOCAL:6 = 0
			CASE 23
				LOCAL:4 = 60
				LOCAL:5 = 40
				LOCAL:6 = 0
			CASE 24
				LOCAL:4 = 10
				LOCAL:5 = 3
				LOCAL:6 = 3
			CASE 25
				LOCAL:4 = 25
				LOCAL:5 = 10
				LOCAL:6 = 10
			CASE 26
				LOCAL:4 = 100
				LOCAL:5 = 30
				LOCAL:6 = 30
			CASE 27
				LOCAL:4 = 10
				LOCAL:5 = 3
				LOCAL:6 = 3
			CASE 28
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 5
			CASE 29
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 5
			CASE 30
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 5
			CASE 31
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 5
			CASE 32
				LOCAL:4 = 20
				LOCAL:5 = 7
				LOCAL:6 = 7
			CASE 33
				LOCAL:4 = 20
				LOCAL:5 = 7
				LOCAL:6 = 7
			CASE 34
				LOCAL:4 = 20
				LOCAL:5 = 7
				LOCAL:6 = 7
			CASE 35
				LOCAL:4 = 20
				LOCAL:5 = 7
				LOCAL:6 = 7
			CASE 36
				LOCAL:4 = 15
				LOCAL:5 = 5
				LOCAL:6 = 5
			CASE 37
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 5
			CASE 38
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 5
			CASE 39
				LOCAL:4 = -30
				LOCAL:5 = 15
				LOCAL:6 = 15
			CASEELSE
				LOCAL:4 = 10
				LOCAL:5 = 5
				LOCAL:6 = 5
		ENDSELECT
		
		CFLAG:(ARG:0):5 += LOCAL:4
		CFLAG:(ARG:0):120 += LOCAL:5
		CFLAG:(ARG:0):121 += LOCAL:6
		IF CFLAG:(ARG:0):120 > 100
			CFLAG:(ARG:0):120 = 100
		ENDIF
		IF CFLAG:(ARG:0):121 > 100
			CFLAG:(ARG:0):121 = 100
		ENDIF
		CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
		CALL PRINT_MESSAGE(ARG:0, 164, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
	ELSE
		CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3, 1)
		CALL PRINT_MESSAGE(ARG:0, 164, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3, 1)
	ENDIF
ELSE
	REUSELASTLINE 入力値が不正です。再入力してください
	GOTO INPUT_LOOP2
ENDIF

RETURN


