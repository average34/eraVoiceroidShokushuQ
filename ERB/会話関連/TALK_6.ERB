;元エネミーとの会話
@TALK_6(ARG:0)
;LOCAL
;0	LOOP
;1	誘えるかどうか
;2	TEMP
;3	使ったアイテム

;5-6	HP低下
;7-8	MP低下
;9		CP低下
;10		寄生

PRINTFORML 迷宮の中を進んでいくと、

TRYCALL PRINT_SHOW_CLOTH(ARG:0)

PRINTFORM %CALLNAME:(ARG:0)%  (戦闘素質 {ABL:(ARG:0):98, 2} / 速度 {ABL:(ARG:0):97, 2})  と出会った
PRINTFORML 

CALL PRINT_MESSAGE(1, 101, ARG:0, CALLNAME:1, CALLNAME:(ARG:0))

WAIT

$TALK_START
IF TALK_LOWHP(ARG)
	LOCAL:5 = 50
	LOCAL:6 = 51
ELSE
	LOCAL:5 = 0
	LOCAL:6 = 0
ENDIF
IF TALK_LOWMP(ARG)
	LOCAL:7 = 52
	LOCAL:8 = 53
ELSE
	LOCAL:7 = 0
	LOCAL:8 = 0
ENDIF
IF BASE:(ARG:0):3 <= 0
	LOCAL:9 = 54
ELSE
	LOCAL:9 = 0
ENDIF
IF CFLAG:(ARG:0):22 && CFLAG:(ARG:0):36 == 0
	LOCAL:10 = 57
ELSE
	LOCAL:10 = 0
ENDIF

;遭遇相手の様子
CALL TALK_LOOK(ARG)

PRINTFORML どうしますか？
PRINTFORML [ 1] 雑談して気を紛らわせる
PRINTFORML [ 2] 情報交換を行う
PRINTFORML [ 3] 何か貰えないか聞いてみる
IF FLAG:11 == 0
	;3人目まで埋まってないなら誘える
	LOCAL:1 = 1
	PRINTFORML [ 4] 仲間に誘う
ELSE
	LOCAL:1 = 0
ENDIF
IF LOCAL:5 && ITEM:50
	PRINTFORML [ 5] %ITEMNAME:50%(残り{ITEM:50}個)をあげる
ELSE
	LOCAL:5 = 0
ENDIF
IF LOCAL:6 && ITEM:51
	PRINTFORML [ 6] %ITEMNAME:51%(残り{ITEM:51}個)をあげる
ELSE
	LOCAL:6 = 0
ENDIF
IF LOCAL:7 && ITEM:52
	PRINTFORML [ 7] %ITEMNAME:52%(残り{ITEM:52}個)をあげる
ELSE
	LOCAL:7 = 0
ENDIF
IF LOCAL:8 && ITEM:53
	PRINTFORML [ 8] %ITEMNAME:53%(残り{ITEM:53}個)をあげる
ELSE
	LOCAL:8 = 0
ENDIF
IF LOCAL:9 && ITEM:54
	PRINTFORML [ 9] %ITEMNAME:54%(残り{ITEM:54}個)をあげる
ELSE
	LOCAL:9 = 0
ENDIF
IF LOCAL:10 && ITEM:57
	PRINTFORML [10] %ITEMNAME:57%(残り{ITEM:57}個)をあげる
ELSE
	LOCAL:10 = 0
ENDIF
SIF GET_PENIS(ARG:0) & 1 && ITEM:55
	PRINTFORML [11] %ITEMNAME:55%(残り{ITEM:55}個)をあげる

PRINTFORML [12] 装備品をプレゼントする

SIF TALENT:(ARG:0):130 >= 1
	PRINTFORML [13] 乳搾り
PRINTFORML [15] 無理矢理欲望を吐き出させる
IF GET_PENIS(1) && (FLAG:520 == 2 || (FLAG:10 == 0 || (FLAG:11 == 0 && (CFLAG:(FLAG:10):29 || GET_PENIS(FLAG:10))) || ((CFLAG:(FLAG:10):29 || GET_PENIS(FLAG:10)) && (CFLAG:(FLAG:11):29 || GET_PENIS(FLAG:11)))))
	;主人公がふたなりで、仲間がいないか全員戦意喪失かふたなりだと犯せる
	PRINTFORML [16] 性欲を発散する
ENDIF
SIF ITEM:8 && ITEM:88 >= 10
	PRINTFORML [17] %ITEMNAME:8%を使う
SIF CFLAG:(ARG:0):47 == 1
	PRINTFORML [18] 貞操帯を外す
SIF CFLAG:1:29 == 0
	PRINTFORML [30] キスをする
PRINTFORML [110] 能力を見る

PRINTFORML [ 0] 何もせず別れを告げる


;＝＝＝＝＝＝＝ここから入力処理＝＝＝＝＝＝＝
$INPUT_LOOP
INPUT

IF RESULT == 0
	;ドッペル警戒、および恨まれてる相手の回避はこれ
	CALL PRINT_MESSAGE(1, 102, ARG:0, CALLNAME:1, CALLNAME:(ARG:0))
	RETURN
ELSEIF RESULT == 1
	CALL CHECK_COUNTER(ARG:0)
	;逆襲された場合、もう何もしない
	SIF RESULT
		RETURN
	
	CALL TALK_EV_1(ARG)
	
ELSEIF RESULT == 2
	CALL CHECK_COUNTER(ARG:0)
	;逆襲された場合、もう何もしない
	SIF RESULT
		RETURN
	
	CALL TALK_EV_2(ARG)
	
ELSEIF RESULT == 3
	CALL CHECK_COUNTER(ARG:0)
	;逆襲された場合、もう何もしない
	SIF RESULT
		RETURN
	
	CALL TALK_EV_3(ARG)

ELSEIF RESULT == 4 && LOCAL:1
	;通常のNPCと同じ
	CALL CHECK_COUNTER(ARG:0)
	;逆襲された場合、もう何もしない
	SIF RESULT
		RETURN
	
	CALL TALK_EV_4(ARG)
	
;アイテム譲渡
ELSEIF RESULT >= 5 && RESULT <= 10 && LOCAL:(RESULT)
	LOCAL:3 = LOCAL:(RESULT)
	CALL ADD_ITEM(LOCAL:3, -1, 0)
	CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
	CALL PRINT_MESSAGE(ARG:0, 164, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), LOCAL:3)
	SELECTCASE LOCAL:3
		CASE 50
			BASE:(ARG:0):0 += MAXBASE:(ARG:0):0 / 2
			CFLAG:(ARG:0):5 += 30
		CASE 51
			BASE:(ARG:0):0 = MAXBASE:(ARG:0):0
			CFLAG:(ARG:0):5 += 60
		CASE 52
			BASE:(ARG:0):1 += MAXBASE:(ARG:0):1 / 4
			CFLAG:(ARG:0):5 += 40
			;主人公が【鼓舞】持ちだと効果増加　ただし発情・戦意喪失・寄生or妊娠末期は無理
			SIF TALENT:1:118 && CFLAG:1:28 == 0 && CFLAG:1:29 == 0 && (CFLAG:1:22 == 0 || CFLAG:1:23 >= 5)
				BASE:(ARG:0):1 += MAXBASE:(ARG:0):1 / 8

				SIF RAND:10 >= 6
					CALL PRINT_MESSAGE(ARG:0, 144, 5, CALLNAME:1, CALLNAME:(ARG:0))
		CASE 53
			BASE:(ARG:0):1 += MAXBASE:(ARG:0):1 / 2
			CFLAG:(ARG:0):5 += 80
			;主人公が【鼓舞】持ちだと効果増加　ただし発情・戦意喪失・寄生or妊娠末期は無理
			SIF TALENT:1:118 && CFLAG:1:28 == 0 && CFLAG:1:29 == 0 && (CFLAG:1:22 == 0 || CFLAG:1:23 >= 5)
				BASE:(ARG:0):1 += MAXBASE:(ARG:0):1 / 4

			;オーバーしたら好感度にボーナス
			IF BASE:(ARG:0):1 > MAXBASE:(ARG:0):1
				BASE:(ARG:0):1 = MAXBASE:(ARG:0):1
				CFLAG:(ARG:0):5 += 40
			ENDIF

				SIF RAND:10 >= 6
					CALL PRINT_MESSAGE(ARG:0, 144, 5, CALLNAME:1, CALLNAME:(ARG:0))
		CASE 54
			BASE:(ARG:0):3 = MAXBASE:(ARG:0):3
			CFLAG:(ARG:0):44 = 0
			CALL CLOTH_TYPE_2(ARG:0)
			;◆触手スーツを君に
			IF (FLAG:(FLAG:5 + 50) + RAND:250) >= 200
				CALL PRINT_MESSAGE(1, 163, ARG:0, CALLNAME:1, CALLNAME:(ARG:0), 54)
				CALL PRINT_MESSAGE((ARG:0), 440, 0, CALLNAME:(ARG:0), "")
				CALL PRINT_MESSAGE((ARG:0), 440, 20, CALLNAME:(ARG:0), "")
				CALL PRINT_MESSAGE(ARG:0, 440, 5, CALLNAME:(ARG:0), "")
				CALL PRINT_MESSAGE(ARG:0, 440, 15, CALLNAME:(ARG:0), "")
				CFLAG:(ARG:0):40 = 1
				BASE:(ARG:0):3 = MAXBASE:(ARG:0):3
				;我々の業界ではご褒美です
				
				CFLAG:(ARG:0):5 += RAND:30
				
			ELSE
				CFLAG:(ARG:0):5 += 40
			ENDIF
			;◆好感度以外触手スーツ
		CASE 57
			CFLAG:(ARG:0):22 = 0
			CFLAG:(ARG:0):5 += 70
				SIF RAND:10 >= 6
					CALL PRINT_MESSAGE(ARG:0, 144, 5, CALLNAME:1, CALLNAME:(ARG:0))
		CASEELSE
			;よく分からないけどとりあえずプラス
			CFLAG:(ARG:0):5 += 30
	ENDSELECT
	GOTO TALK_START

;ふたなりを治す
ELSEIF RESULT == 11
	CALL ADD_ITEM(55, -1, 0)
		SIF CFLAG:(ARG:0):42 > 0
			CFLAG:(ARG:0):42 = 0
		;触手なので嫌がる
		CFLAG:(ARG:0):5 -= 30
	GOTO TALK_START

;母乳飲み
ELSEIF RESULT == 13 && TALENT:(ARG:0):130 >= 1
	
	TFLAG:63 = 1
		CALL PRINT_MESSAGE(ARG:0, 144, 7, CALLNAME:1, CALLNAME:(ARG:0))
		CALL DRINK_MILK_RECOVERY(ARG:0, 1)
	;仲間も回復
		IF FLAG:10 > 0 && CFLAG:(FLAG:10):42 && CFLAG:(FLAG:10):29 == 0
			CALL DRINK_MILK_RECOVERY(ARG:0, FLAG:10)
		ENDIF

		IF FLAG:11 > 0 && CFLAG:(FLAG:11):42 && CFLAG:(FLAG:11):29 == 0
			CALL DRINK_MILK_RECOVERY(ARG:0, FLAG:11)
		ENDIF
		FOR LOCAL:0,0,(RAND:3 +2)
			CALL DAMAGE_COMMON(ARG:0, 2, 1000, 100)
		NEXT
		CALL PRINT_MESSAGE(ARG:0, 144, 12, CALLNAME:1, CALLNAME:(ARG:0))
	;成功なら好感度は上がる。百合ですね　催眠でもこっち
	CFLAG:(ARG:0):5 += RAND:30

	SIF CFLAG:(ARG:0):506 > 10
		CFLAG:(ARG:0):506 -= RAND:25
	
	CALL ADD_ABL_EXP_PT(13, 3 + RAND:5)
	CALL ADD_ABL_EXP_PT(2, 700)

ELSEIF RESULT == 12
	CALL PRESENT(ARG:0, 0)
	GOTO TALK_START
ELSEIF RESULT == 15
	CALL NPC_RAPE_2(ARG:0)
	WAIT
;触手なので催眠状態でなくても拘束したり性欲発散したり
ELSEIF RESULT == 16 && GET_PENIS(1) && (FLAG:520 == 2 || (FLAG:10 == 0 || (FLAG:11 == 0 && (CFLAG:(FLAG:10):29 || GET_PENIS(FLAG:10))) || ((CFLAG:(FLAG:10):29 || GET_PENIS(FLAG:10)) && (CFLAG:(FLAG:11):29 || GET_PENIS(FLAG:11)))))
	CALL NPC_RAPE(ARG:0)
	WAIT
	CALL ADD_ABL_EXP_PT(13, 3 + RAND:5)
ELSEIF RESULT == 17&& ITEM:8 && ITEM:88 >= 10
	CALL ADD_ITEM(8, -1, 0)
	CALL ADD_ITEM(88, -10, 0)
	CFLAG:(ARG:0):504 = 1
	CALL PRINT_MESSAGE(ARG:0, 144, 13, CALLNAME:1, CALLNAME:(ARG:0))
ELSEIF RESULT == 18 && CFLAG:(ARG:0):47 == 1
	CFLAG:(ARG:0):47 = 0
	PRINTFORMW 貞操帯を外した
	GOTO TALK_START
ELSEIF RESULT == 30 && CFLAG:1:29 == 0
	CALL NPC_KISS(ARG:0)
	WAIT
ELSEIF RESULT == 110
	CALL SHOW_PERSONAL_STATUS(ARG:0)
	GOTO TALK_START
ELSE
	REUSELASTLINE 入力値が不正です。再入力してください
	GOTO INPUT_LOOP
ENDIF

