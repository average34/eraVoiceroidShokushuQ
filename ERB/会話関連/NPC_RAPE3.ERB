;出会い頭レイポゥ
;基本的に主人公をいじめる場合はNPC_RAPE_2
;NPCいじめはNPC_RAPE
;ARG:0	襲ってくるキャラ
@NPC_RAPE_3(ARG:0)

IF GET_PENIS(ARG:0) == 0
	RETURN
ENDIF

IF ABL:(ARG:0):12 + RAND:3 < 2
	RETURN
ENDIF

IF CFLAG:(ARG:0):28
	PRINTFORM 発情した
ENDIF

PRINTFORML %CALLNAME:(ARG:0)%が擬似陰茎を鎮めてほしいと頼んできた
PRINTFORML なんと答えますか？
PRINTFORML [1] はい
PRINTFORML [2] いえす
PRINTFORML [3] 目をそらす
$INPUT_LOOP
INPUT

IF RESULT == 1

	;相手のほうが戦闘素質が低いかHP30%以下だと足
	IF ABL:1:98 > ABL:(ARG:0):98 || BASE:(ARG:0):0 * 100 / MAXBASE:(ARG:0):0 < 30
		CALL PRINT_MESSAGE(ARG:0, 465, 0, CALLNAME:1,CALLNAME:(ARG:0))
		CALL PRINT_MESSAGE(1, 465, 1, CALLNAME:(ARG:0),CALLNAME:1, ARG:0)
	;それ以外だと口
	ELSE
		CALL PRINT_MESSAGE(ARG:0, 465, 2, CALLNAME:1,CALLNAME:(ARG:0))
		CALL PRINT_MESSAGE(1, 465, 3, CALLNAME:(ARG:0),CALLNAME:1, ARG:0)
	ENDIF

	TFLAG:63 = 2
	LOCAL:5 = CALC_SENSITIVITY(ARG:0, TFLAG:63, 2500 + RAND:2001)
	SIF LOCAL:5 > 20000
		LOCAL:5 = 20000 + RAND:((LOCAL:5 - 19970) / 30)
	CALL DAMAGE_COMMON(ARG:0, 2, LOCAL:5, 100)
	LOCAL:1 = ABL:1:14 + 2

	CALL ADD_ABL_EXP(13, 1, LOCAL:1 * 2)
	CALL ADD_ABL_EXP(13, ARG:0, LOCAL:1 * 2)
	CALL ADD_ABL_EXP(14, 1, LOCAL:1 * (2 + TALENT:(ARG:0):185))
	CFLAG:(ARG:0):5 += 10

ELSEIF RESULT == 2

	;手で渋々
	CALL PRINT_MESSAGE(ARG:0, 465, 4, CALLNAME:1,CALLNAME:(ARG:0))
	CALL PRINT_MESSAGE(1, 465, 5, CALLNAME:(ARG:0),CALLNAME:1, ARG:0)

	SIF LOCAL:5 > 20000
		LOCAL:5 = 20000 + RAND:((LOCAL:5 - 19970) / 30)
	LOCAL:1 = ABL:1:14 + 2
	FOR  LOCAL:0,0,LOCAL:1
		TFLAG:63 = 2
		CALL DAMAGE_COMMON(ARG:0, 2, RAND:(LOCAL:1 * 1000), 100)
	NEXT

	CALL ADD_ABL_EXP(13, 1, LOCAL:1 * 2)
	CALL ADD_ABL_EXP(13, ARG:0, LOCAL:1 * 2)
	CALL ADD_ABL_EXP(14, 1, LOCAL:1 * (2 + TALENT:(ARG:0):185))
	CFLAG:(ARG:0):5 += 5


ELSEIF RESULT == 3

		;逃げようとしてレイポゥ　好感度は一番上がる
		CALL PRINT_MESSAGE(ARG:0, 465, 6, CALLNAME:1,CALLNAME:(ARG:0))
		CALL PRINT_MESSAGE(1, 465, 7, CALLNAME:(ARG:0),CALLNAME:1, ARG:0)

		IF TALENT:1:122
			TFLAG:63 = 0
		ELSE
			TFLAG:63 = 3
		ENDIF
		LOCAL:5 = CALC_SENSITIVITY(1, TFLAG:63, 2500 + RAND:2001)
		LOCAL:5 = LOCAL:5 * (4 + 2 * (TALENT:(ARG:0):170 + TALENT:(ARG:0):171) + TALENT:(ARG:0):185) / 4
		SIF LOCAL:5 > 20000
			LOCAL:5 = 20000 + RAND:((LOCAL:5 - 19970) / 30)
		CALL DAMAGE_COMMON(1, 2, LOCAL:5, 100)
		LOCAL:1 = ABL:1:14 + 2
		FOR  LOCAL:0,0,LOCAL:1
			TFLAG:63 = 2
			CALL DAMAGE_COMMON(ARG:0, 2, 8000 + RAND:4001, 100)
		NEXT
		
		CALL ADD_ABL_EXP(13, 1, LOCAL:1 * 2)
		CALL ADD_ABL_EXP(13, ARG:0, LOCAL:1 * 2)
		CALL ADD_ABL_EXP(14, 1, LOCAL:1 * (2 + TALENT:(ARG:0):185))
		CFLAG:(ARG:0):5 += 20

	IF CFLAG:1:22 == 0 && RAND:4 == 0
		;生まれるのはシェイプシフター
		CALL PARASITE_TYPE(1, 1, 17, 8 + LIMIT(RAND:4 + RAND:4 + RAND:4 + RAND:4, 1, 10), 2, ARG:0)
	ENDIF
ELSE
	CLEARLINE 1
	REUSELASTLINE 入力が不正です！
	GOTO INPUT_LOOP
ENDIF
