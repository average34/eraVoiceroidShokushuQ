;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;固定イベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
;大半の関数は元のと共通なのでこちらにはない
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
@CHECK_FIXED_EVENT_S_180
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

LOCAL:3 = 0

;目標値（イベント難易度）決定
LOCAL:1 = 150

;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT

IF LOCAL:2 >= LOCAL:1
	;一人でもこっそり経験値加わる
	CALL ADD_ABL_EXP_PT(0, 500)
	
	;仲間がいると発動
	IF FLAG:10
		;危機回避と術式知識が高いと避けられる
		IF (ABL:1:5 + TALENT:1:164 + RAND:2 > 2) || (FLAG:10 && ABL:(FLAG:10):5 + TALENT:(FLAG:10):164 + RAND:2 > 2) || (FLAG:11 && ABL:(FLAG:11):5 + TALENT:(FLAG:11):164 + RAND:2 > 2)
			PRINTFORML 起動していない魔法陣を見つけた
			IF TALENT:1:164 == 2 || (FLAG:10 && TALENT:(FLAG:10):164 == 2) || (FLAG:11 && TALENT:(FLAG:11):164 == 2)
				PRINTFORM どうやら身体入れ替えの魔法陣のようだが
			ENDIF
			PRINTFORML 入りますか？
			CALL ASK_YN
			;入らなければスルー
			IF RESULT == 0
				CALL BODY_CHANGE(GET_MEMBER_SUM())
				;TODO:ここでこう呼び出しても入れ替わり周りの情報が渡されないからそこら辺どうにかできないだろうか
				CALL PRINT_MESSAGE(1, 200, 180, CALLNAME:1, "", 2)
				CALL PRINT_MESSAGE(FLAG:10, 200, 180, CALLNAME:1, "", 2)
				CALL PRINT_MESSAGE(FLAG:11, 200, 180, CALLNAME:1, "", 2)
			ENDIF
		;仲間がいると発動
		ELSE
			CALL BODY_CHANGE(GET_MEMBER_SUM())
			;TODO:ここでこう呼び出しても入れ替わり周りの情報が渡されないからそこら辺どうにかできないだろうか
			CALL PRINT_MESSAGE(1, 200, 180, CALLNAME:1, "", 2)
			CALL PRINT_MESSAGE(FLAG:10, 200, 180, CALLNAME:1, "", 2)
			CALL PRINT_MESSAGE(FLAG:11, 200, 180, CALLNAME:1, "", 2)
		ENDIF
	ENDIF

	;イベントを別の場所に移動
	FLAG:180 = RAND:30 + 1
	CALL WAIT_AUTOMODE(400, 0)
	
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3


