;固定イベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_S_171
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値

LOCAL:3 = 0

;目標値（イベント難易度）決定
LOCAL:1 = 90


;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT


IF LOCAL:2 >= LOCAL:1
	IF FLAG:98 == 0
		;開けなかった場合、何度も経験値が入るという小技
		CALL ADD_ABL_EXP_PT(0, 700)
		PRINTFORML 誰かの荷物袋が落ちている！　開けてみますか？
		
		$INPUT_LOOP
		PRINTFORML [0] はい
		PRINTFORML [1] いいえ
		IF GET_PENIS(1) > 0
			PRINTFORML [2] %CALLNAME:1%のおちんちんを中に入れて安全を確認する
		ENDIF
		IF FLAG:10 && GET_PENIS(FLAG:10) > 0
			PRINTFORML [3] %CALLNAME:(FLAG:10)%のおちんちんを中に入れて安全を確認する
		ENDIF
		IF FLAG:11 && GET_PENIS(FLAG:11) > 0
			PRINTFORML [4] %CALLNAME:(FLAG:11)%のおちんちんを中に入れて安全を確認する
		ENDIF

		INPUT

		IF RESULT == 0
			;開ける場合、イベント削除
			FLAG:171 = 0
		
			PRINTFORML %CALLNAME:1%%TACHI()%は荷物袋を開けてみた…
			PRINTFORMW 突然袋の中から敵が現れ、%CALLNAME:1%%TACHI()%に襲い掛かってきた！
			CALL PRINT_MESSAGE(1, 200, 171, CALLNAME:1, "")
			CALL PRINT_MESSAGE(FLAG:10, 200, 171, CALLNAME:1, "")
			CALL PRINT_MESSAGE(FLAG:11, 200, 171, CALLNAME:1, "")
			CALL CREATE_ENEMY(98, FLAG:5, 0)
			CALL PRE_BATTLE(4)
			RETURN 2
		ELSEIF RESULT == 1
			;開けない場合、イベントは残す
			CALL PRINT_MESSAGE(1, 200, 171, CALLNAME:1, "", 1)
			CALL PRINT_MESSAGE(FLAG:10, 200, 171, CALLNAME:1, "", 1)
			CALL PRINT_MESSAGE(FLAG:11, 200, 171, CALLNAME:1, "", 1)
		ELSEIF (RESULT == 2 && GET_PENIS(1) > 0) || (RESULT == 3 && GET_PENIS(FLAG:10) > 0) || (RESULT == 4 && GET_PENIS(FLAG:11) > 0)
			IF RESULT == 2
				LOCAL:6 = 1
			ELSEIF RESULT == 3
				LOCAL:6 = FLAG:10
			ELSEIF RESULT == 4
				LOCAL:6 = FLAG:11
			ENDIF
			;ヒュプノなのでダメージ回数MAX固定
			FOR LOCAL:0, 0, 7
				CALL PRINT_MESSAGE(LOCAL:6, 200, 171, CALLNAME:(LOCAL:6), "", 10 + LOCAL:0)
				TFLAG:63 = 2
				LOCAL:5 = CALC_SENSITIVITY(LOCAL:6, TFLAG:63, LOCAL:1)
				CALL DAMAGE_COMMON(LOCAL:6, 2, LOCAL:5 * 7 * (TALENT:(LOCAL:6):103 + 2) * (TALENT:(LOCAL:6):77 + 1), 500)
				PRINTFORML 
			NEXT
			;処理が終わったら後始末
			FOR LOCAL:0, 0, VARSIZE("DA", 1)
				DA:(FLAG:1):(LOCAL:0) = 0
			NEXT
			
			PRINTFORML 
			PRINTFORML この荷物袋は危険だ！
			PRINTFORML 
			;開けない場合、イベントは残す
			CALL PRINT_MESSAGE(1, 200, 171, CALLNAME:1, "", 1)
			CALL PRINT_MESSAGE(FLAG:10, 200, 171, CALLNAME:1, "", 1)
			CALL PRINT_MESSAGE(FLAG:11, 200, 171, CALLNAME:1, "", 1)
		ELSE
			REUSELASTLINE 入力値が不正です。再入力してください
			GOTO INPUT_LOOP
		ENDIF
	ELSEIF FLAG:98
		PRINTFORMW 何かが逃げる音がした……
		FLAG:171 = RAND:30 + 1
		LOCAL:3 = 1
	
	ENDIF
	LOCAL:3 = 1
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3

