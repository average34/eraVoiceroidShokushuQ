;固定イベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_S_182
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値

LOCAL:3 = 0

;目標値（イベント難易度）決定
LOCAL:1 = 40

;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT

IF LOCAL:2 >= LOCAL:1
	CALL ADD_ABL_EXP_PT(0, 500)
	
	;危機回避と術式知識が高いと避けられる
	IF (ABL:1:5 + TALENT:1:164 + RAND:2 > 2) || (FLAG:10 && ABL:(FLAG:10):5 + TALENT:(FLAG:10):164  + RAND:2 > 2) || (FLAG:11 && ABL:(FLAG:11):5 + TALENT:(FLAG:11):164 + RAND:2 > 2)
		PRINTFORML 起動していない魔法陣を見つけた
		IF TALENT:1:164 == 2 || (FLAG:10 && TALENT:(FLAG:10):164 == 2) || (FLAG:11 && TALENT:(FLAG:11):164 == 2)
			PRINTFORM どうやら回復の魔法陣のようだが
		ENDIF
		PRINTFORML 入りますか？
		CALL ASK_YN
		;入らなければスルー
		IF RESULT == 0
			IF BASE:1:0 < MAXBASE:1:0
				BASE:1:0 = MAXBASE:1:0
				PRINTFORML %CALLNAME:1%のHPが全回復した！
			ELSE
				CALL ADD_ITEM(51, 1, 0)
			ENDIF
			IF BASE:1:1 < MAXBASE:1:1
				BASE:1:1 = MAXBASE:1:1
				PRINTFORML %CALLNAME:1%のMPが全回復した！
			ELSE
				CALL ADD_ITEM(53, 1, 0)
			ENDIF
			IF BASE:1:3 < MAXBASE:1:3
				BASE:1:3 = MAXBASE:1:3
				PRINTFORML %CALLNAME:1%のCPが全回復した！
			ELSE
				CALL ADD_ITEM(54, 1, 0)
			ENDIF
			IF CFLAG:1:29
				CFLAG:1:29 = 0
				PRINTFORML %CALLNAME:1%の戦意喪失が回復した！
			ELSE
				CALL ADD_ITEM(58, 1, 0)
			ENDIF
			IF BASE:(FLAG:10):0 < MAXBASE:(FLAG:10):0
				BASE:(FLAG:10):0 = MAXBASE:(FLAG:10):0
				PRINTFORML %CALLNAME:(FLAG:10)%のHPが全回復した！
			ELSE
				CALL ADD_ITEM(51, 1, 0)
			ENDIF
			IF BASE:(FLAG:10):1 < MAXBASE:(FLAG:10):1
				BASE:(FLAG:10):1 = MAXBASE:(FLAG:10):1
				PRINTFORML %CALLNAME:(FLAG:10)%のMPが全回復した！
			ELSE
				CALL ADD_ITEM(53, 1, 0)
			ENDIF
			IF BASE:(FLAG:10):3 < MAXBASE:(FLAG:10):3
				BASE:(FLAG:10):3 = MAXBASE:(FLAG:10):3
				PRINTFORML %CALLNAME:(FLAG:10)%のCPが全回復した！
			ELSE
				CALL ADD_ITEM(54, 1, 0)
			ENDIF
			IF CFLAG:(FLAG:10):29
				CFLAG:(FLAG:10):29 = 0
				PRINTFORML %CALLNAME:(FLAG:10)%の戦意喪失が回復した！
			ELSE
				CALL ADD_ITEM(58, 1, 0)
			ENDIF
			IF BASE:(FLAG:11):0 < MAXBASE:(FLAG:11):0
				BASE:(FLAG:11):0 = MAXBASE:(FLAG:11):0
				PRINTFORML %CALLNAME:(FLAG:11)%のHPが全回復した！
			ELSE
				CALL ADD_ITEM(51, 1, 0)
			ENDIF
			IF BASE:(FLAG:11):1 < MAXBASE:(FLAG:11):1
				BASE:(FLAG:11):1 = MAXBASE:(FLAG:11):1
				PRINTFORML %CALLNAME:(FLAG:11)%のMPが全回復した！
			ELSE
				CALL ADD_ITEM(53, 1, 0)
			ENDIF
			IF BASE:(FLAG:11):3 < MAXBASE:(FLAG:11):3
				BASE:(FLAG:11):3 = MAXBASE:(FLAG:11):3
				PRINTFORML %CALLNAME:(FLAG:11)%のCPが全回復した！
			ELSE
				CALL ADD_ITEM(54, 1, 0)
			ENDIF
			IF CFLAG:(FLAG:11):29
				CFLAG:(FLAG:11):29 = 0
				PRINTFORML %CALLNAME:(FLAG:11)%の戦意喪失が回復した！
			ELSE
				CALL ADD_ITEM(58, 1, 0)
			ENDIF
		ENDIF
		CALL PRINT_MESSAGE(1, 200, 182, CALLNAME:1, "", 0)
		CALL PRINT_MESSAGE(FLAG:10, 200, 182, CALLNAME:1, "", 0)
		CALL PRINT_MESSAGE(FLAG:11, 200, 182, CALLNAME:1, "", 0)
	ELSE
		IF BASE:1:0 < MAXBASE:1:0
			BASE:1:0 = MAXBASE:1:0
			PRINTFORML %CALLNAME:1%のHPが全回復した！
		ELSE
			CALL ADD_ITEM(51, 1, 0)
		ENDIF
		IF BASE:1:1 < MAXBASE:1:1
			BASE:1:1 = MAXBASE:1:1
			PRINTFORML %CALLNAME:1%のMPが全回復した！
		ELSE
			CALL ADD_ITEM(53, 1, 0)
		ENDIF
		IF BASE:1:3 < MAXBASE:1:3
			BASE:1:3 = MAXBASE:1:3
			PRINTFORML %CALLNAME:1%のCPが全回復した！
		ELSE
			CALL ADD_ITEM(54, 1, 0)
		ENDIF
		IF CFLAG:1:29
			CFLAG:1:29 = 0
			PRINTFORML %CALLNAME:1%の戦意喪失が回復した！
		ELSE
			CALL ADD_ITEM(58, 1, 0)
		ENDIF
		IF BASE:(FLAG:10):0 < MAXBASE:(FLAG:10):0
			BASE:(FLAG:10):0 = MAXBASE:(FLAG:10):0
			PRINTFORML %CALLNAME:(FLAG:10)%のHPが全回復した！
		ELSE
			CALL ADD_ITEM(51, 1, 0)
		ENDIF
		IF BASE:(FLAG:10):1 < MAXBASE:(FLAG:10):1
			BASE:(FLAG:10):1 = MAXBASE:(FLAG:10):1
			PRINTFORML %CALLNAME:(FLAG:10)%のMPが全回復した！
		ELSE
			CALL ADD_ITEM(53, 1, 0)
		ENDIF
		IF BASE:(FLAG:10):3 < MAXBASE:(FLAG:10):3
			BASE:(FLAG:10):3 = MAXBASE:(FLAG:10):3
			PRINTFORML %CALLNAME:(FLAG:10)%のCPが全回復した！
		ELSE
			CALL ADD_ITEM(54, 1, 0)
		ENDIF
		IF CFLAG:(FLAG:10):29
			CFLAG:(FLAG:10):29 = 0
			PRINTFORML %CALLNAME:(FLAG:10)%の戦意喪失が回復した！
		ELSE
			CALL ADD_ITEM(58, 1, 0)
		ENDIF
		IF BASE:(FLAG:11):0 < MAXBASE:(FLAG:11):0
			BASE:(FLAG:11):0 = MAXBASE:(FLAG:11):0
			PRINTFORML %CALLNAME:(FLAG:11)%のHPが全回復した！
		ELSE
			CALL ADD_ITEM(51, 1, 0)
		ENDIF
		IF BASE:(FLAG:11):1 < MAXBASE:(FLAG:11):1
			BASE:(FLAG:11):1 = MAXBASE:(FLAG:11):1
			PRINTFORML %CALLNAME:(FLAG:11)%のMPが全回復した！
		ELSE
			CALL ADD_ITEM(53, 1, 0)
		ENDIF
		IF BASE:(FLAG:11):3 < MAXBASE:(FLAG:11):3
			BASE:(FLAG:11):3 = MAXBASE:(FLAG:11):3
			PRINTFORML %CALLNAME:(FLAG:11)%のCPが全回復した！
		ELSE
			CALL ADD_ITEM(54, 1, 0)
		ENDIF
		IF CFLAG:(FLAG:11):29
			CFLAG:(FLAG:11):29 = 0
			PRINTFORML %CALLNAME:(FLAG:11)%の戦意喪失が回復した！
		ELSE
			CALL ADD_ITEM(58, 1, 0)
		ENDIF
		CALL PRINT_MESSAGE(1, 200, 182, CALLNAME:1, "", 0)
		CALL PRINT_MESSAGE(FLAG:10, 200, 182, CALLNAME:1, "", 0)
		CALL PRINT_MESSAGE(FLAG:11, 200, 182, CALLNAME:1, "", 0)
	ENDIF

	;イベントを別の場所に移動
	FLAG:182 = RAND:30 + 1
	WAIT
	
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3


