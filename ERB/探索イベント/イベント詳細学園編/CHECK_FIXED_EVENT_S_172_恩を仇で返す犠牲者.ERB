;ランダムイベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_S_172
#DIM LCOUNT
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値
;4	ダメージ
;5	犠牲者決定
;6	犠牲者ID
;7	ダメージ計算用
;8	レイプダメージ

LOCAL:3 = 0
LOCAL:4 = 0
LOCAL:5 = 0

;目標値（イベント難易度）決定
LOCAL:1 = 60


;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT


IF LOCAL:2 >= LOCAL:1
	CALL ADD_ABL_EXP_PT(0, 700)
	PRINTFORML %CALLNAME:1%%TACHI()%は知り合いの女の子が触手に捕まっているのを見つけた！
	PRINTFORML 助けますか？
	
	CALL ASK_YN
	IF RESULT == 0
		FOR LCOUNT, 0, 3
			IF GET_MEMBER(LCOUNT)
				CALL PRINT_MESSAGE(1, 200, 172, CALLNAME:LCOUNT, "", 0)
				;助け出すのに戦闘力が高いほどHPCP消耗が低い
				LOCAL:4 = 4000 * (1 + RAND:4) / (ABL:LCOUNT:98 + 80)
				BASE:LCOUNT:0 -= LOCAL:4
				BASE:LCOUNT:3 -= LOCAL:4
				;HP0にはならない
				SIF BASE:LCOUNT:0 <= 0
					BASE:LCOUNT:0 = 1
			ENDIF
		NEXT
		PRINTFORML %CALLNAME:1%%TACHI()%は少し消耗しながらも助け出すことができた！
		IF CFLAG:1:29 == 0
			LOCAL:5 ++
		ENDIF
		IF FLAG:10 && CFLAG:(FLAG:10):29 == 0
			LOCAL:5 ++
		ENDIF
		IF FLAG:11 && CFLAG:(FLAG:11):29 == 0
			LOCAL:5 ++
		ENDIF
		LOCAL:6 = GET_MEMBER(RAND:(LOCAL:5))
		
		PRINTFORML だが助けられた女の子は%CALLNAME:(LOCAL:6)%を襲い始めた！
		TFLAG:63 = RAND:4
		LOCAL:7 = CALC_SENSITIVITY(LOCAL:6, TFLAG:63, 500 + RAND:500) * (RAND:4 + 1) / 2
		FOR  LOCAL:0, 0, 3
			CALL DAMAGE_COMMON(LOCAL:6, 2, LOCAL:7, 100)
		NEXT
		
		CALL ADD_ABL_EXP(13, LOCAL:6, 3)
		
		CALL PRINT_MESSAGE(1, 200, 172, CALLNAME:1, "", 1)
		CALL PRINT_MESSAGE(FLAG:10, 200, 172, CALLNAME:1, "", 1)
		CALL PRINT_MESSAGE(FLAG:11, 200, 172, CALLNAME:1, "", 1)
	ELSE
		PRINTFORML %CALLNAME:1%%TACHI()%は罠を警戒して彼女に見つからないようにその場を離れた……
		CALL PRINT_MESSAGE(1, 200, 172, CALLNAME:1, "", 2)
		CALL PRINT_MESSAGE(FLAG:10, 200, 172, CALLNAME:1, "", 2)
		CALL PRINT_MESSAGE(FLAG:11, 200, 172, CALLNAME:1, "", 2)
	ENDIF
	CALL WAIT_AUTOMODE(400, 0)
	LOCAL:3 = 1
	FLAG:172 = RAND:30 + 1
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3

