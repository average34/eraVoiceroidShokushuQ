;固定イベント
;意図的な強ポジ、澄んだ泉枠
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_S_138
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値
;4	アイテムの種類決定

LOCAL:3 = 0
LOCAL:4 = 0

;目標値（イベント難易度）決定
LOCAL:1 = 60


;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT


IF LOCAL:2 >= LOCAL:1 || FLAG:138 >= 100
	;経験値が入るのは最初だけ
	IF FLAG:138 < 100
		CALL ADD_ABL_EXP_PT(0, 1000)
		FLAG:138 += 100
	ENDIF
	PRINTFORML ここは社のようだ！
	IF FLAG:(50 + FLAG:5) <= 20 
		PRINTFORML 神聖な雰囲気により浄化力が回復した！
		FLAG:6 += 20 + RAND:20
	ENDIF
	PRINTFORML 何をしますか？
	
	$INPUT_LOOP
	PRINTFORML [1] 探索する
	SIF FLAG:6 >= 300 && (CFLAG:1:29 == 1 || CFLAG:(FLAG:10):29 == 1 || CFLAG:(FLAG:11):29 == 1)
		PRINTFORML [2] 浄化力を使って仲間を癒す (必要浄化力:300)
	;妊娠と母乳治療
	SIF FLAG:6 >= 300 && ((CFLAG:1:36 == 3 || (CFLAG:1:36 == 0 && CFLAG:1:22)) || (CFLAG:(FLAG:10):36 == 3 || (CFLAG:(FLAG:10):36 == 0 && CFLAG:(FLAG:10):22)) || (CFLAG:(FLAG:11):36 == 3 || (CFLAG:(FLAG:11):36 == 0 && CFLAG:(FLAG:11):22)))
		PRINTFORML [3] 浄化力と体力を使って寄生・妊娠を治療する (必要浄化力:300)
	SIF FLAG:6 >= 300 && (TALENT:1:130 == 1 || TALENT:(FLAG:10):130 == 1 || TALENT:(FLAG:11):130 == 1)
		PRINTFORML [4] 浄化力を使って母乳体質を治療する (必要浄化力:300)
	PRINTFORML [0] 何もせずに立ち去る


	INPUT

	IF RESULT == 1
		
		PRINTFORML %CALLNAME:1%%TACHI()%は社を探してみた…
		PRINTFORML アイテムが見つかった！
		CALL PRINT_MESSAGE(1, 200, 138, CALLNAME:1, "")
		CALL PRINT_MESSAGE(FLAG:10, 200, 138, CALLNAME:1, "")
		CALL PRINT_MESSAGE(FLAG:11, 200, 138, CALLNAME:1, "")
		FOR LOCAL:0, 0,(GET_PT_MAX_ABL(1) / 2 + 1)
			SELECTCASE RAND:120
				CASE 0 TO 9
					LOCAL:4 = 2
				CASE 10 TO 19
					LOCAL:4 = 6
				CASE 20 TO 29
					LOCAL:4 = 15
				CASE 30 TO 39
					LOCAL:4 = 27
				CASE 40 TO 49
					LOCAL:4 = 28
				CASE 50 TO 59
					LOCAL:4 = 29
				CASE 60 TO 69
					LOCAL:4 = 32
				CASE 70 TO 79
					LOCAL:4 = 33
				CASE 80 TO 89
					LOCAL:4 = 36
				CASE 90 TO 94
					LOCAL:4 = 51
				CASE 95 TO 99
					LOCAL:4 = 53
				CASE 100 TO 109
					LOCAL:4 = 74
				CASEELSE
					LOCAL:4 = 75
			ENDSELECT
			CALL ADD_ITEM(LOCAL:4, RAND:2 + 1, 1)
		NEXT
		WAIT
	
	ELSEIF RESULT == 2
		PRINTFORML 泉の澄んだ水と浄化の力が、%CALLNAME:1%%TACHI()%の体を癒す！
		SIF CFLAG:1:29 == 0
			CALL PRINT_MESSAGE(1, 200, 138, CALLNAME:1, "", 3)
		SIF CFLAG:(FLAG:10):29 == 0
			CALL PRINT_MESSAGE(FLAG:10, 200, 138, CALLNAME:(FLAG:10), "", 3)
		SIF CFLAG:(FLAG:10):29 == 0
			CALL PRINT_MESSAGE(FLAG:11, 200, 138, CALLNAME:(FLAG:11), "", 3)
		FLAG:6 -= 300
		IF CFLAG:1:29 == 1
			PRINTFORML %CALLNAME:1%の瞳に光が戻った！
			CALL PRINT_MESSAGE(1, 200, 138, CALLNAME:1, "", 4)
			BASE:1:1 = MAXBASE:1:1 / 4
			CFLAG:1:29 = 0
		ENDIF
		IF CFLAG:(FLAG:10):29 == 1
			PRINTFORML %CALLNAME:(FLAG:10)%の瞳に光が戻った！
			CALL PRINT_MESSAGE(FLAG:10, 200, 138, CALLNAME:(FLAG:10), "", 4)
			BASE:(FLAG:10):1 = MAXBASE:(FLAG:10):1 / 4
			CFLAG:(FLAG:10):29 = 0
		ENDIF
		IF CFLAG:(FLAG:11):29 == 1
			PRINTFORML %CALLNAME:(FLAG:11)%の瞳に光が戻った！
			CALL PRINT_MESSAGE(FLAG:11, 200, 138, CALLNAME:(FLAG:11), "", 4)
			BASE:(FLAG:11):1 = MAXBASE:(FLAG:11):1 / 4
			CFLAG:(FLAG:11):29 = 0
		ENDIF
	ELSEIF RESULT == 3
		PRINTFORML 泉の澄んだ水と浄化の力が、%CALLNAME:1%%TACHI()%の胎内の異形を消滅させる！
		PRINTFORML だが、強すぎる浄化の力は宿主である%CALLNAME:1%%TACHI()%の体力も同時に奪っていった……
		FLAG:6 -= 300
		IF CFLAG:1:36 == 3 || (CFLAG:1:36 == 0 && CFLAG:1:22)
			PRINTFORML %CALLNAME:1%の胎内に巣食う異形は消滅した！
			BASE:1:0 = 0
			CFLAG:1:22 = 0
			CFLAG:1:23 = 0
			CFLAG:1:36 = 0
		ENDIF
		IF CFLAG:(FLAG:10):36 == 3 || (CFLAG:(FLAG:10):36 == 0 && CFLAG:(FLAG:10):22)
			PRINTFORML %CALLNAME:(FLAG:10)%の胎内に巣食う異形は消滅した！
			BASE:(FLAG:10):0 = 0
			CFLAG:(FLAG:10):22 = 0
			CFLAG:(FLAG:10):23 = 0
			CFLAG:(FLAG:10):36 = 0
		ENDIF
		IF CFLAG:(FLAG:11):36 == 3 || (CFLAG:(FLAG:11):36 == 0 && CFLAG:(FLAG:11):22)
			PRINTFORML %CALLNAME:(FLAG:11)%の胎内に巣食う異形は消滅した！
			BASE:(FLAG:11):0 = 0
			CFLAG:(FLAG:11):22 = 0
			CFLAG:(FLAG:11):23 = 0
			CFLAG:(FLAG:11):36 = 0
		ENDIF
	ELSEIF RESULT == 4
		PRINTFORML 泉の澄んだ水と浄化の力が、%CALLNAME:1%%TACHI()%の胸をあるべき状態へと戻した！
		FLAG:6 -= 300
		IF TALENT:1:130
			PRINTFORML %CALLNAME:1%の母乳が止まった！
			TALENT:1:130 = 0
		ENDIF
		IF TALENT:(FLAG:10):130
			PRINTFORML %CALLNAME:(FLAG:10)%の母乳が止まった！
			TALENT:(FLAG:10):130 = 0
		ENDIF
		IF TALENT:(FLAG:11):130
			PRINTFORML %CALLNAME:(FLAG:11)%の母乳が止まった！
			TALENT:(FLAG:11):130 = 0
		ENDIF
	ELSEIF RESULT == 0
		;開けない場合、イベントは残す
		CALL PRINT_MESSAGE(1, 200, 138, CALLNAME:1, "", 1)
		CALL PRINT_MESSAGE(FLAG:10, 200, 138, CALLNAME:1, "", 1)
		CALL PRINT_MESSAGE(FLAG:11, 200, 138, CALLNAME:1, "", 1)
	ELSE
		REUSELASTLINE 入力値が不正です。再入力してください
		GOTO INPUT_LOOP
	ENDIF
	LOCAL:3 = 1
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3

