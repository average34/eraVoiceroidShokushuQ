;固定イベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_150
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値
;4	被害者あり

LOCAL:3 = 0

;目標値（イベント難易度）決定
LOCAL:1 = LIMIT(RAND:100, 50, 100) + RAND:150


;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT


IF LOCAL:2 >= LOCAL:1
	CALL ADD_ABL_EXP_PT(0, LOCAL:1 * 10)
	PRINTFORMW 迷宮内を探索していると、突然天井から大きな岩が降ってきた！
	PRINTFORML 
	LOCAL:4 = 0
	IF LOCAL:1 > RAND:(100 + ABL:1:5 * 50)
		CALL ADD_ABL_EXP(5, 1, 1000 + RAND:(ABL:1:5 * 500 + 1))
		CALL PRINT_MESSAGE(1, 200, 150, CALLNAME:1, "", 1)
		CALL DAMAGE_COMMON(1, 0, LOCAL:1 * 10)
		LOCAL:4 = 1
		WAIT
	ELSE
		CALL ADD_ABL_EXP(5, 1, 500 + RAND:(ABL:1:5 * 200 + 1))
		CALL PRINT_MESSAGE(1, 200, 150, CALLNAME:1, "", 2)
	ENDIF
	IF FLAG:10
		IF LOCAL:1 > RAND:(100 + ABL:(FLAG:10):5 * 50)
			CALL ADD_ABL_EXP(5, FLAG:10, 1000 + RAND:(ABL:(FLAG:10):5 * 500 + 1))
			CALL PRINT_MESSAGE(FLAG:10, 200, 150, CALLNAME:1, "", 1)
			CALL DAMAGE_COMMON(FLAG:10, 0, LOCAL:1 * 10)
			LOCAL:4 = 1
			WAIT
		ELSE
			CALL ADD_ABL_EXP(5, FLAG:10, 500 + RAND:(ABL:(FLAG:10):5 * 200 + 1))
			CALL PRINT_MESSAGE(FLAG:10, 200, 150, CALLNAME:1, "", 2)
		ENDIF
	ENDIF
	IF FLAG:11
		IF LOCAL:1 > RAND:(100 + ABL:(FLAG:11):5 * 50)
			CALL ADD_ABL_EXP(5, FLAG:11, 1000 + RAND:(ABL:(FLAG:11):5 * 500 + 1))
			CALL PRINT_MESSAGE(FLAG:11, 200, 150, CALLNAME:1, "", 1)
			CALL DAMAGE_COMMON(FLAG:11, 0, LOCAL:1 * 10)
			LOCAL:4 = 1
			WAIT
		ELSE
			CALL ADD_ABL_EXP(5, FLAG:11, 500 + RAND:(ABL:(FLAG:10):5 * 200 + 1))
			CALL PRINT_MESSAGE(FLAG:11, 200, 150, CALLNAME:1, "", 2)
		ENDIF
	ENDIF
	
	IF LOCAL:4
		PRINTFORML 
		PRINTFORML 落石に巻き込まれて傷を負ったものの、%CALLNAME:1%%TACHI()%は探索を再開した…
	ELSE
		PRINTFORML 
		PRINTFORML 落石を避けきった%CALLNAME:1%%TACHI()%は、そのまま探索を再開した…
	ENDIF
	
	WAIT
	
	;別の場所に再配置
	FLAG:150 = RAND:30 + 1
	LOCAL:3 = 1
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3

