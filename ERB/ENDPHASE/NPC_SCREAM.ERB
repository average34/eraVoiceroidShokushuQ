;捕食処理
@NPC_SCREAM(CHARA_ID)
#DIM CHARA_ID
#DIM SHOW_SCREAM ;0:非表示 1:表示

VARSET SHOW_SCREAM

;ありえないIDのキャラは除外
IF !INRANGE(CHARA_ID, 0, CHARANUM - 1)
	RETURN
;主人公も除外
ELSEIF CHARA_ID == 1
	RETURN
ENDIF

;現在捕食されていないなら処理せず戻る
IF CFLAG:CHARA_ID:10 == 0 && CFLAG:CHARA_ID:504 < 2
	RETURN
ENDIF


;主人公と同じか隣の部屋にいるなら描写

;同じ部屋
IF CFLAG:CHARA_ID:4 == FLAG:5
	SHOW_SCREAM = 1
;主人公が上の部屋
ELSEIF CFLAG:CHARA_ID:4 == FLAG:5 + 5 && CFLAG:CHARA_ID:4 > 5
	SHOW_SCREAM = 1
;主人公が左の部屋
ELSEIF CFLAG:CHARA_ID:4 == FLAG:5 + 1 && (CFLAG:CHARA_ID:4 % 5) != 1
	SHOW_SCREAM = 1
;主人公が右の部屋
ELSEIF CFLAG:CHARA_ID:4 == FLAG:5 - 1 && (CFLAG:CHARA_ID:4 % 5) != 0
	SHOW_SCREAM = 1
;主人公が下の部屋
ELSEIF CFLAG:CHARA_ID:4 == FLAG:5 - 5 && CFLAG:CHARA_ID:4 < 26
	SHOW_SCREAM = 1
;主人公が遠い
ELSE
	SHOW_SCREAM = 0
ENDIF


IF SHOW_SCREAM
	;プライド高いと悲鳴を挙げないことがある
	IF TALENT:CHARA_ID:15 && RAND:3 == 0
	
	ELSE
		CALL PRINT_MESSAGE(CHARA_ID, 551, 0, CALLNAME:CHARA_ID, "", CFLAG:CHARA_ID:4)
		CALL PRINT_MESSAGE(1, 551, 1, CALLNAME:CHARA_ID, "", CFLAG:CHARA_ID:4, CHARA_ID)
	ENDIF
ENDIF

