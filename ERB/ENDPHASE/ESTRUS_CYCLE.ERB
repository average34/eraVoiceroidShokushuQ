;発情周期チェック
@ESTRUS_CYCLE(CHARA_ID)
#DIM CHARA_ID
;CHARA_ID	対象キャラID
;LOCAL:0	LOOP
;LOCAL:1	月経周期何日目か
;月経周期は面倒なので30日計算
;12～14が排卵直前なので一番危ない
;15～17が排卵日
;28～2が月経
;
;妊娠率は返す数値%なので射精量以下の確率に確定

;周期の30で割ったあまりから月経日を引くと最後の月経から何日目かが出る
;負の数値の場合は30を足してやって0～29で判別
LOCAL:1 = (DAY % 30) - CFLAG:(CHARA_ID):150
SIF LOCAL:1 < 0
	LOCAL:1 += 30

;卵巣パッチON
;排卵日は一般的に月経の14日前とされる
;-2:封印卵巣, -1:未熟卵巣	安全日0-29日目	現在取得手段なし
;0:成熟卵巣		月経0日目 安全1-11日目 危険12-14日目(3日) 排卵15-17日目(3日) 安全18-29日目
;1:活発卵巣		月経0日目 安全1-11日目 危険12-14日目(3日) 排卵15-18日目(4日) 安全19-29日目
;2:異常排卵巣	月経0日目 安全1-9日目 危険10-13日目(4日) 排卵14-19日目(6日) 安全20-29日目
;3:肥大化卵巣	月経0日目 安全1-6日目 危険7-12日目(6日) 排卵13-20日目(8日) 安全21-29日目
;4:苗床卵巣, 5:メス嫁苗床卵巣	排卵0-29日目
IF FLAG:535 == 1
	;-2:封印卵巣
	IF TALENT:(CHARA_ID):137 <= -2
		SELECTCASE LOCAL:1
			CASE 0 TO 29
				RETURN 10
		ENDSELECT
	;-1:未熟卵巣
	ELSEIF TALENT:(CHARA_ID):137 <= -1
		SELECTCASE LOCAL:1
			CASE 0 TO 29
				RETURN 3
		ENDSELECT
	;0:成熟卵巣
	ELSEIF TALENT:(CHARA_ID):137 == 0
		SELECTCASE LOCAL:1
			CASE 0 TO 3
				RETURN 15
			CASE 4 TO 7
				RETURN 50
			CASE 8 TO 11
				RETURN 70
			CASE 12 TO 14
				RETURN 150
			CASE 15 TO 17
				RETURN 100
			CASE 18 TO 20
				RETURN 60
			CASE 21 TO 23
				RETURN 60
			CASE 24 TO 26
				RETURN 40
			CASE 27 TO 29
				RETURN 15
		ENDSELECT
	;1:活発卵巣
	ELSEIF TALENT:(CHARA_ID):137 == 1
		SELECTCASE LOCAL:1
			CASE 0 TO 3
				RETURN 15
			CASE 4 TO 7
				RETURN 50
			CASE 8 TO 11
				RETURN 70
			CASE 11 TO 14
				RETURN 150
			CASE 15 TO 18
				RETURN 100
			CASE 19 TO 21
				RETURN 60
			CASE 22 TO 24
				RETURN 60
			CASE 25 TO 27
				RETURN 40
			CASE 28 TO 29
				RETURN 15
		ENDSELECT
	;2:異常排卵巣
	ELSEIF TALENT:(CHARA_ID):137 == 2
		SELECTCASE LOCAL:1
			CASE 0 TO 2
				RETURN 15
			CASE 3 TO 6
				RETURN 50
			CASE 7 TO 9
				RETURN 70
			CASE 10 TO 13
				RETURN 150
			CASE 14 TO 19
				RETURN 100
			CASE 20 TO 23
				RETURN 60
			CASE 24 TO 26
				RETURN 60
			CASE 27 TO 28
				RETURN 40
			CASE 29
				RETURN 15
		ENDSELECT
	;3:肥大化卵巣
	ELSEIF TALENT:(CHARA_ID):137 == 3
		SELECTCASE LOCAL:1
			CASE 0
				RETURN 15
			CASE 2 TO 3
				RETURN 50
			CASE 4 TO 6
				RETURN 70
			CASE 7 TO 12
				RETURN 150
			CASE 13 TO 20
				RETURN 100
			CASE 21 TO 24
				RETURN 60
			CASE 25 TO 29
				RETURN 40
		ENDSELECT
	;4:苗床卵巣
	ELSEIF TALENT:(CHARA_ID):137 == 4
		SELECTCASE LOCAL:1
			CASE 0 TO 2
				RETURN 90
			CASE 3 TO 6
				RETURN 100
			CASE 7 TO 12
				RETURN 150
			CASE 13 TO 26
				RETURN 100
			CASE 27 TO 29
				RETURN 90
		ENDSELECT	
	;5:メス嫁苗床卵巣
	ELSEIF TALENT:(CHARA_ID):137 == 5
		SELECTCASE LOCAL:1
			CASE 0 TO 29
				RETURN 150
		ENDSELECT
	ENDIF
	
;卵巣パッチOFF
;通常		月経0日目 安全日1-10日目 危険日12-14日目(3日) 排卵15-17日目(3日) 安全日18-29日目
ELSE
	SELECTCASE LOCAL:1
		CASE 0 TO 3
			RETURN 15
		CASE 4 TO 7
			RETURN 50
		CASE 8 TO 11
			RETURN 70
		CASE 12 TO 14
			RETURN 150
		CASE 15 TO 17
			RETURN 100
		CASE 18 TO 20
			RETURN 60
		CASE 21 TO 23
			RETURN 60
		CASE 24 TO 26
			RETURN 40
		CASE 27 TO 29
			RETURN 15
	ENDSELECT
ENDIF



