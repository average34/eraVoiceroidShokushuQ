@FIX_ENEMY_ACTION_574(ARG:0)

TFLAG:52 = ARG:0
TFLAG:54 = DA:(ARG:0):51
TFLAG:55 = 4
TFLAG:60 = 1

TFLAG:57 = DA:(ARG:0):5

TFLAG:58 = 200
TFLAG:61 = 100

TFLAG:64 = 1
TFLAG:65 = 1

TFLAG:91 = 0

CALL ACTION_FILTER(-1, 5, 574, CALLNAME:(TFLAG:54), SAVESTR:(TFLAG:52), TFLAG:54, TFLAG:65)


;拘束レベルアップ時の追加処理
@EXTRA_CAPTURE_574(ENEMY_ID, CHARA_ID)
#DIM ENEMY_ID
#DIM CHARA_ID

;丸呑みフラグが立っていないなら立てる
SIF CFLAG:CHARA_ID:21 != 1
	CFLAG:CHARA_ID:21 = 1

;テキスト表現ルナティック以上だと、深く飲み込まれる度に骨を折られる（レベル1以上飲み込まれてから）
SIF FLAG:507 > 1 && CFLAG:CHARA_ID:38 >= 1 && CFLAG:CHARA_ID:201 < 3
	CFLAG:CHARA_ID:201 += 1

CALL PRINT_MESSAGE(CHARA_ID, 15, 574, CALLNAME:CHARA_ID, SAVESTR:ENEMY_ID, CFLAG:CHARA_ID:21)

;テキスト表現ルナ以上だと追加ダメージ
IF FLAG:507 > 1 && CFLAG:38 >= 2
	IF CFLAG:201 < 3
		CALL DAMAGE_COMMON(CHARA_ID, 0, DA:ENEMY_ID:5 + (MAXBASE:CHARA_ID:HP / 2) + 500 + RAND:500)
		CALL DAMAGE_COMMON(CHARA_ID, 1, (MAXBASE:CHARA_ID:MP / (1000 + RAND:500)) * DA:ENEMY_ID:5 + RAND:100)
	;骨折レベル最大だとダメージ2倍
	ELSE
		CALL DAMAGE_COMMON(CHARA_ID, 0, DA:ENEMY_ID:5 + ((MAXBASE:CHARA_ID:HP / 2) + 500 + RAND:1000) * 2)
		CALL DAMAGE_COMMON(CHARA_ID, 1, ((MAXBASE:CHARA_ID:MP / (1000 + RAND:500)) * DA:ENEMY_ID:5 + RAND:100) * 2)
	ENDIF
ENDIF
