@FIX_ENEMY_ACTION_42(ENEMY_ID)
#DIM ENEMY_ID

TFLAG:52 = ENEMY_ID
TFLAG:54 = DA:ENEMY_ID:51
TFLAG:55 = 1
TFLAG:60 = 1

TFLAG:57 = DA:ENEMY_ID:5

TFLAG:58 = 30
TFLAG:61 = 120 ;拘束中のはずなので確実に当たる

TFLAG:64 = 100
TFLAG:99 = 42

CALL ACTION_FILTER(-1, 7, 42, CALLNAME:(TFLAG:54), SAVESTR:ENEMY_ID, TFLAG:54)


@EXTRA_ACTION_42(ENEMY_ID, CHARA_ID)
#DIM ENEMY_ID
#DIM CHARA_ID

;直前になってMPが半分より多くなった場合(仲間が回復アイテムを使ったり)
IF BASE:CHARA_ID:1 > MAXBASE:CHARA_ID:1 * 1 / 2
	PRINTFORML 気力を取り戻した%CALLNAME:ENEMY_ID%は激しく暴れて抗った！
	PRINTFORML %SAVESTR:ENEMY_ID%は獲物の抵抗力を奪うべく、更に%CALLNAME:ENEMY_ID%の身体を痛めつけた！
	;まずHPに制裁ダメージ
	CALL DAMAGE_COMMON(CHARA_ID, 0, 100 + RAND:200, 100)
	;HPが尽きたらMPダメージ
	IF BASE:CHARA_ID:0 <= 0
		PRINTFORML %SAVESTR:ENEMY_ID%の暴虐の前に、力尽きた%CALLNAME:ENEMY_ID%の精神が削られていく！
		CALL DAMAGE_COMMON(CHARA_ID, 1, (MAXBASE:CHARA_ID:1) * 1 / 100 + RAND:100, 100)
	ENDIF
	;これでMP半分にされたら抵抗虚しく肉盾に
	IF BASE:CHARA_ID:1 <= MAXBASE:CHARA_ID:1 * 1 / 2
		PRINTFORML 抵抗虚しく
		CFLAG:CHARA_ID:202 = 1
		DA:ENEMY_ID:36 = CHARA_ID
		;戦意喪失でない仲間(主人公ふくむ)のTP変化
		IF CFLAG:1:29 == 0
			CALL CHANGE_TP(1, 22)
		ENDIF
		IF FLAG:10 != 0 && CFLAG:(FLAG:10):29 == 0
			CALL CHANGE_TP(FLAG:10, 22)
		ENDIF
		IF FLAG:10 != 0 && CFLAG:(FLAG:11):29 == 0
			CALL CHANGE_TP(FLAG:11, 22)
		ENDIF
	;MPが残っていたら抵抗成功(処理一切なし)
	ELSE
	ENDIF
;発動時にMP半分以下ならそのまま肉盾化
ELSE
	CFLAG:CHARA_ID:202 = 1
	DA:ENEMY_ID:36 = CHARA_ID
	;戦意喪失でない仲間(主人公ふくむ)のTP変化
	IF CFLAG:1:29 == 0
		CALL CHANGE_TP(1, 22)
	ENDIF
	IF FLAG:10 != 0 && CFLAG:(FLAG:10):29 == 0
		CALL CHANGE_TP(FLAG:10, 22)
	ENDIF
	IF FLAG:10 != 0 && CFLAG:(FLAG:11):29 == 0
		CALL CHANGE_TP(FLAG:11, 22)
	ENDIF
ENDIF
CALL PRINT_MESSAGE(CHARA_ID, 17, TFLAG:99, CALLNAME:CHARA_ID, SAVESTR:ENEMY_ID, CHARA_ID)

