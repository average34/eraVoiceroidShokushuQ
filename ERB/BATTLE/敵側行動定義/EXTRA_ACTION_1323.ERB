@EXTRA_ACTION_1323(ENEMY_ID, CHARA_ID)
#DIM ENEMY_ID
#DIM CHARA_ID
;LOCAL
;1	命中率
;2	化ける先(NoだったりIDだったりする)
;3	夢のパターン
;20	ふたなり保持用
;21	睡眠保持用
;TFLAG
;98	LOCAL:2 * 100 + LOCAL:3

;睡眠
IF CFLAG:CHARA_ID:25 > 0
	LOCAL:1 = 100
ELSE
	LOCAL:1 = 0
ENDIF


IF RAND:100 < LOCAL:1
	;夢の設定
	IF RAND:3 == 0 && FLAG:10
		;仲間にふたなりを犯される
		LOCAL:3 = 50
		SELECTCASE CHARA_ID
			CASE 1
				LOCAL:2 = FLAG:(10 + RAND:(GET_MEMBER_SUM() - 1)) ;こっちはID
			CASE FLAG:10
				IF FLAG:11 && RAND:2
					LOCAL:2 = FLAG:11
				ELSE
					LOCAL:2 = 1
				ENDIF
			CASE FLAG:11
				IF RAND:2
					LOCAL:2 = FLAG:10
				ELSE
					LOCAL:2 = 1
				ENDIF
			ENDSELECT
	ELSE
		;仲良しに普通に犯される
		LOCAL:3 = RAND:8
		CALL KANKEI_RANK(NO:CHARA_ID, CHARA_ID) ;こっちはNo
		SELECTCASE RAND:100
			CASE IS < 50
				LOCAL:2 = CFLAG:CHARA_ID:651
			CASE IS < 75
				LOCAL:2 = CFLAG:CHARA_ID:652
			CASE IS < 87
				LOCAL:2 = CFLAG:CHARA_ID:653
			CASE IS < 94
				LOCAL:2 = CFLAG:CHARA_ID:654
			CASEELSE
				LOCAL:2 = CFLAG:CHARA_ID:655
		ENDSELECT
	ENDIF
	TFLAG:98 = LOCAL:2 * 100 + LOCAL:3

	CALL PRINT_MESSAGE(CHARA_ID, 17, TFLAG:99, CALLNAME:CHARA_ID, SAVESTR:ENEMY_ID, CHARA_ID)

	;ダメージとか
	LOCAL:21 = CFLAG:CHARA_ID:25
	CFLAG:CHARA_ID:25 = 0 ;口上用に一瞬起こす
	IF LOCAL:3 == 50
		LOCAL:20 = TALENT:CHARA_ID:121
			TALENT:CHARA_ID:121 = 1
			TFLAG:63 = 2
			CALL DAMAGE_COMMON(LOCAL:2, 2, LOCAL:5, 0)
			CALL ADD_ABL_EXP(12, CHARA_ID, 4 + RAND:3)
			TALENT:CHARA_ID:121 = LOCAL:20
	ELSE
		SELECTCASE LOCAL:3
			CASE 2, 4, 6
				TFLAG:63 = 1
			CASE 3, 5
				TFLAG:63 = 2
			CASE 0, 1, 7
				TFLAG:63 = 3
		ENDSELECT
		LOCAL:5 = CALC_SENSITIVITY(CHARA_ID, TFLAG:63, 5000 + RAND:1500)
		CALL DAMAGE_COMMON(CHARA_ID, 2, LOCAL:5, 100)
	ENDIF
	CFLAG:CHARA_ID:25 = LOCAL:21
ELSE
	CALL PRINT_MESSAGE(CHARA_ID, 27, TFLAG:99, CALLNAME:CHARA_ID, SAVESTR:ENEMY_ID, CHARA_ID)
ENDIF

PRINTL 
