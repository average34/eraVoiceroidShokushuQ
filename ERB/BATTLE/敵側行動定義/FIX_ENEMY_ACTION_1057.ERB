@FIX_ENEMY_ACTION_1057(ENEMY_ID)
#DIM ENEMY_ID

TFLAG:52 = ENEMY_ID
TFLAG:54 = DA:ENEMY_ID:51
TFLAG:55 = 3
TFLAG:60 = 1

TFLAG:57 = DA:ENEMY_ID:5

TFLAG:58 = 85
TFLAG:61 = 120

TFLAG:64 = 0
TFLAG:65 = 0

TFLAG:59 = 0
TFLAG:90 = 50
TFLAG:91 = 0
TFLAG:92 = 0

TFLAG:99 = 1057

TFLAG:63 = 5

CALL ACTION_FILTER(-1, 4, 1057, CALLNAME:(TFLAG:54), SAVESTR:ENEMY_ID, TFLAG:54, TFLAG:63)


@EXTRA_ACTION_1057(ENEMY_ID, CHARA_ID)
#DIM ENEMY_ID
#DIM CHARA_ID
#DIM DRAIN_POWER
;LOCAL
;1	命中率


DRAIN_POWER = 0
IF ABL:CHARA_ID:98 >= 5 && FLAG:4 >= 3
	DRAIN_POWER = RAND:5 + 1
	IF BASE:CHARA_ID:HP <= 0
		DRAIN_POWER += MIN(RAND:20, ABL:CHARA_ID:98 / 20)
	ENDIF
	DA:ENEMY_ID:5 += DRAIN_POWER
	ABL:CHARA_ID:98 = MAX(1, ABL:CHARA_ID:98 - DRAIN_POWER)
ELSE
	DRAIN_POWER = RAND:5 + 1
	IF BASE:CHARA_ID:HP <= 0
		DRAIN_POWER += RAND:20
	ENDIF
	DA:ENEMY_ID:5 += DRAIN_POWER
ENDIF

CALL PRINT_MESSAGE(CHARA_ID, 17, TFLAG:99, CALLNAME:CHARA_ID, SAVESTR:ENEMY_ID, CHARA_ID, DRAIN_POWER)

