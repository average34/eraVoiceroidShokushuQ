;拘束からの離脱
;CHARA_ID	実行キャラ
@FIX_PT_ACTION_42(CHARA_ID)
#DIM CHARA_ID

;全部こちらで処理するのでメイン処理不要
TFLAG:66 = 1

SETCOLOR 0x10EEEE
IF CFLAG:CHARA_ID:20
	CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:20), CFLAG:CHARA_ID:21, 0, CFLAG:CHARA_ID:20)
ELSE
	CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:10), CFLAG:CHARA_ID:21, 0, CFLAG:CHARA_ID:10)
ENDIF
RESETCOLOR

IF CFLAG:CHARA_ID:35 && (TALENT:CHARA_ID:34 == 0 || RAND:2 == 0)
	CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, "", CFLAG:CHARA_ID:21, 1)
	CFLAG:CHARA_ID:53 = 0
	RETURN
ENDIF

CALL GET_RELEASE_RATE(CHARA_ID)
LOCAL:1 = RESULT
CFLAG:CHARA_ID:53 /= 2

;捕虜にされていた場合、自力で脱出しようとすると制裁される(霊撃安定)
IF CFLAG:CHARA_ID:202
	CALL PRINT_MESSAGE(CHARA_ID, 520, 0, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:20))
	CALL DAMAGE_COMMON(CHARA_ID, 0, 1500 + RAND:500)
	CALL DAMAGE_COMMON(CHARA_ID, 1, (MAXBASE:CHARA_ID:1) * (10 + RAND:5) / 100 + RAND:200)
	LOCAL:1 /= 2
ENDIF

PRINTFORML 成功率：{LOCAL:1}％

IF RAND:100 < LOCAL:1
	CALL ADD_ABL_EXP(5, CHARA_ID, 200 + RAND:200)
	IF CFLAG:CHARA_ID:20 || CFLAG:CHARA_ID:21
		CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:20), CFLAG:CHARA_ID:21, 2, CFLAG:CHARA_ID:20)
		CALL PANTSU_NUGASHI(CHARA_ID, CALLNAME:CHARA_ID, CFLAG:CHARA_ID:20, CFLAG:CHARA_ID:21)
	ELSE
		CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:10), CFLAG:CHARA_ID:21, 2, CFLAG:CHARA_ID:10)
	ENDIF
	CALL STATUS_RENEW_RELEASE(CHARA_ID, 1, 4)
	
;二度目のチェックで拘束レベルが1以上の場合はダウンの判定
ELSEIF RAND:100 < LOCAL:1 && CFLAG:CHARA_ID:38 > 0
	CALL ADD_ABL_EXP(5, CHARA_ID, 200 + RAND:300)
	IF CFLAG:CHARA_ID:20
		CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:20), CFLAG:CHARA_ID:21, 3, CFLAG:CHARA_ID:20)
	ELSE
		CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:10), CFLAG:CHARA_ID:21, 3, CFLAG:CHARA_ID:10)
	ENDIF
	CFLAG:CHARA_ID:38 -= 1
ELSE
	CALL ADD_ABL_EXP(5, CHARA_ID, 400 + RAND:400)
	IF CFLAG:CHARA_ID:20
		CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:20), CFLAG:CHARA_ID:21, 4, CFLAG:CHARA_ID:20)
	ELSE
		CALL PRINT_MESSAGE(CHARA_ID, 1, 42, CALLNAME:CHARA_ID, SAVESTR:(CFLAG:CHARA_ID:10), CFLAG:CHARA_ID:21, 4, CFLAG:CHARA_ID:10)
	ENDIF
ENDIF

